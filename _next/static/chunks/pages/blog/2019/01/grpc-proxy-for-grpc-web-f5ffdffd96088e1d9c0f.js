(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[342],{3905:function(e,t,r){"use strict";r.d(t,{kt:function(){return m}});var n=r(7294);function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function s(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?s(Object(r),!0).forEach((function(t){a(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):s(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function o(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},s=Object.keys(e);for(n=0;n<s.length;n++)r=s[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(n=0;n<s.length;n++)r=s[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}var c=n.createContext({}),l=function(e){var t=n.useContext(c),r=t;return e&&(r="function"===typeof e?e(t):i(i({},t),e)),r},p={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},u=n.forwardRef((function(e,t){var r=e.components,a=e.mdxType,s=e.originalType,c=e.parentName,u=o(e,["components","mdxType","originalType","parentName"]),m=l(r),d=a,h=m["".concat(c,".").concat(d)]||m[d]||p[d]||s;return r?n.createElement(h,i(i({ref:t},u),{},{components:r})):n.createElement(h,i({ref:t},u))}));function m(e,t){var r=arguments,a=t&&t.mdxType;if("string"===typeof e||a){var s=r.length,i=new Array(s);i[0]=u;var o={};for(var c in t)hasOwnProperty.call(t,c)&&(o[c]=t[c]);o.originalType=e,o.mdxType="string"===typeof e?e:a,i[1]=o;for(var l=2;l<s;l++)i[l]=r[l];return n.createElement.apply(null,i)}return n.createElement.apply(null,r)}u.displayName="MDXCreateElement"},911:function(e,t,r){"use strict";r.d(t,{Z:function(){return f}});r(7294);var n=r(9008),a=r(1664),s=r(1163),i=r(4184),o=r.n(i),c=r(381),l=r.n(c),p=r(7814),u=r(4007),m=r(5893),d=function(e){return(0,m.jsxs)("aside",{className:o()("widget mb-4",e.className),children:[(0,m.jsx)("h1",{className:"title font-weight-bold",children:e.title}),e.children]})},h=function(e){return e||"https://yuku.takahashi.coffee".concat(u.hs)},f=(0,s.withRouter)((function(e){return(0,m.jsxs)("div",{className:"blogpage container",children:[(0,m.jsxs)(n.default,{children:[(0,m.jsxs)("title",{children:[e.meta.title," - ",u.px]}),(0,m.jsx)("meta",{name:"description",content:e.meta.description}),(0,m.jsx)("meta",{name:"twitter:card",content:"summary"}),(0,m.jsx)("meta",{name:"twitter:creator",content:"@yuku_t"}),(0,m.jsx)("meta",{property:"fb:app_id",content:u.f6}),(0,m.jsx)("meta",{property:"og:title",content:"".concat(e.meta.title," - ").concat(u.px)}),(0,m.jsx)("meta",{property:"og:type",content:"article"}),(0,m.jsx)("meta",{property:"og:url",content:"https://yuku.takahashi.coffee".concat(e.router.pathname)}),(0,m.jsx)("meta",{property:"og:image",content:h()}),(0,m.jsx)("meta",{property:"og:description",content:e.meta.description}),(0,m.jsx)("link",{rel:"stylesheet",href:"https://cdnjs.cloudflare.com/ajax/libs/prism/1.15.0/themes/prism.min.css"}),(0,m.jsx)("link",{rel:"stylesheet",href:"https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css"})]}),(0,m.jsxs)("div",{className:"row",children:[(0,m.jsx)("main",{className:o()("col-xl-8",e.className),children:(0,m.jsxs)("article",{itemScope:!0,itemType:"http://schema.org/BlogPosting",children:[(0,m.jsx)("meta",{itemProp:"author",content:"Yuku Takahashi"}),(0,m.jsx)("meta",{itemProp:"datePublished",content:e.meta.publishedAt}),e.meta.modifiedAt&&(0,m.jsx)("meta",{itemProp:"dateModified",content:e.meta.modifiedAt}),(0,m.jsx)("meta",{itemProp:"image",content:h()}),(0,m.jsxs)("header",{className:"mb-4 header",children:[(0,m.jsx)("h1",{className:"headline",itemProp:"headline",children:e.meta.title}),(0,m.jsxs)("ul",{className:"list-inline text-dark font-weight-light",children:[(0,m.jsx)("li",{className:"list-inline-item",children:(0,m.jsx)("span",{className:"ml-1",children:l()(e.meta.publishedAt).format("YYYY-MM-DD HH:mm")})}),(0,m.jsx)("li",{className:"list-inline-item",children:e.meta.tags.map((function(e,t){return[t>0?",":null,(0,m.jsxs)("span",{className:"ml-1",children:["#",e]},t)]}))})]})]}),(0,m.jsx)("section",{className:"mb-4 body",itemProp:"articleBody",children:e.children})]})}),(0,m.jsx)("div",{className:"col-xl-4",children:(0,m.jsxs)("div",{className:"pl-xl-2",children:[(0,m.jsx)(d,{title:"About Me",children:(0,m.jsxs)("div",{children:[(0,m.jsx)("img",{src:u.hs,alt:"avatar",className:"avatar rounded-circle mb-4 mx-auto d-block"}),(0,m.jsxs)("p",{children:["Software Engineer at FLYWHEEL. Working mainly on recommendation systems in these days. Ex-Qiita CTO.",(0,m.jsx)(a.default,{href:"/about",children:(0,m.jsx)("a",{href:"/about",style:{marginLeft:"4px"},children:"Read more"})}),"."]})]})}),(0,m.jsx)(d,{title:"Follow",children:(0,m.jsxs)("ul",{className:"list-inline icons",children:[(0,m.jsx)("li",{className:"list-inline-item",children:(0,m.jsx)("a",{href:"https://twitter.com/yuku_t",children:(0,m.jsxs)("span",{className:"fa-stack fa-lg",children:[(0,m.jsx)(p.G,{icon:"circle",className:"fa-stack-2x"}),(0,m.jsx)(p.G,{icon:["fab","twitter"],inverse:!0,className:"fa-stack-1x"})]})})}),(0,m.jsx)("li",{className:"list-inline-item",children:(0,m.jsx)("a",{href:"https://github.com/yuku",children:(0,m.jsxs)("span",{className:"fa-stack fa-lg",children:[(0,m.jsx)(p.G,{icon:"circle",className:"fa-stack-2x"}),(0,m.jsx)(p.G,{icon:["fab","github"],inverse:!0,className:"fa-stack-1x"})]})})}),(0,m.jsx)("li",{className:"list-inline-item",children:(0,m.jsx)("a",{href:"/static/rss-feed.xml",children:(0,m.jsxs)("span",{className:"fa-stack fa-lg",children:[(0,m.jsx)(p.G,{icon:"circle",className:"fa-stack-2x"}),(0,m.jsx)(p.G,{icon:"rss",inverse:!0,className:"fa-stack-1x"})]})})})]})})]})})]})]})}))},2922:function(e,t,r){"use strict";var n=r(7294),a=r(911),s=r(5893);t.Z=function(e){var t=e.meta,r=e.children;return(0,n.useEffect)((function(){if(t.loadTwitterWidget){var e=document.createElement("script");e.async=!0,e.src="https://platform.twitter.com/widgets.js",document.body.appendChild(e)}}),[t.loadTwitterWidget]),(0,s.jsx)(a.Z,{className:"mdx",meta:t,children:r})}},7506:function(e,t,r){"use strict";r.r(t),r.d(t,{metadata:function(){return c},default:function(){return u}});var n=r(159),a=r(219),s=(r(7294),r(3905)),i=r(2922),o=["components"],c={description:"In order for gRPC to communicate with gRPC-Web, you need to set up a proxy, such as Envoy. This article describes why gRPC-Web needs a proxy.",loadTwitterWidget:!0,modifiedAt:"2019-01-25T23:26:00+09:00",publishedAt:"2019-01-25T22:30:00+09:00",tags:["gRPC"],title:"Why gRPC-Web Needs Proxy"},l={metadata:c},p=function(e){var t=e.children;return(0,s.kt)(i.Z,{meta:c},t)};function u(e){var t=e.components,r=(0,a.Z)(e,o);return(0,s.kt)(p,(0,n.Z)({},l,r,{components:t,mdxType:"MDXLayout"}),(0,s.kt)("p",null,"When I read the gRPC-Web documentation, I was surprised to see ",(0,s.kt)("a",{parentName:"p",href:"https://www.envoyproxy.io/"},"Envoy")," used without any explanation:"),(0,s.kt)("blockquote",null,(0,s.kt)("p",{parentName:"blockquote"},"In this example, we will use the ",(0,s.kt)("a",{parentName:"p",href:"https://www.envoyproxy.io/"},"Envoy")," proxy to forward the gRPC browser request to the backend server. - ",(0,s.kt)("a",{parentName:"p",href:"https://grpc.io/docs/tutorials/basic/web.html"},"gRPC Basics - Web"))),(0,s.kt)("p",null,"gRPC uses HTTP2. Since modern browsers are able to communicate over HTTP2, I don't see the need to set up a proxy if I support only such browsers. Why do I need a proxy like Envoy nonetheless?"),(0,s.kt)("h2",null,"Browser Restriction"),(0,s.kt)("p",null,"There is a hint in the documentation describing the gRPC-Web protocol:"),(0,s.kt)("blockquote",null,(0,s.kt)("p",{parentName:"blockquote"},"decouple from HTTP/2 framing which is not, and will never, be directly exposed by browsers - ",(0,s.kt)("a",{parentName:"p",href:"https://github.com/grpc/grpc/blob/f0bfcd864c7a2395ad82ff9db8e39d0c51d49ee0/doc/PROTOCOL-WEB.md"},"grpc/PROTOCOL-WEB.md at master \xb7 grpc/grpc"))),(0,s.kt)("p",null,"In short:"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"JavaScript running in the browser does not provide full control over HTTP2."),(0,s.kt)("li",{parentName:"ul"},"The gRPC protocol uses features of HTTP/2 that cannot be controlled by JavaScript."),(0,s.kt)("li",{parentName:"ul"},"So that a proxy is required.")),(0,s.kt)("p",null,"And I think the restriction will never be removed."),(0,s.kt)("h2",null,"Why Restricted?"),(0,s.kt)("p",null,"Why am I so sure that browser will keep the restriction?"),(0,s.kt)("p",null,"The reason can be explained by considering the position of HTTP2 in the public Web. HTTP/1.1 has been used on the Web for a long time. So you can expect your web servers to be able to communicate over HTTP/1.1. However, it is not clear whether they can communicate over HTTP2. Therefore, a browser uses HTTP2 if it can communicate with a web server over HTTP2, but otherwise, it will fall back to HTTP/1.1."),(0,s.kt)("p",null,"Also, because of the concept of layered architecture, Web application must not know whether HTTP2 or HTTP/1.1 is used under the hood. This means HTTP/1.1 and HTTP2 must be able to be handled transparently so that browser will never provide a way to control a feature only available in HTTP2 by JavaScript."),(0,s.kt)("p",null,"gRPC uses the such HTTP2-only feature."),(0,s.kt)("h2",null,"References"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"https://github.com/grpc/grpc/blob/f0bfcd8/doc/PROTOCOL-WEB.md"},"grpc/PROTOCOL-WEB.md \xb7 grpc/grpc")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"https://github.com/grpc/grpc/blob/f0bfcd864c7a2395ad82ff9db8e39d0c51d49ee0/doc/PROTOCOL-HTTP2.md"},"grpc/PROTOCOL-HTTP2.md \xb7 grpc/grpc")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"https://github.com/grpc/grpc-web/issues/347"},"Why is envoy proxy required? \xb7 Issue #347 \xb7 grpc/grpc-web")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"https://github.com/k2wanko/gae-grpc-web"},"k2wanko/gae-grpc-web: Example: gRPC Web on Google App Engine / Go"))))}u.isMDXComponent=!0},1923:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/blog/2019/01/grpc-proxy-for-grpc-web",function(){return r(7506)}])},159:function(e,t,r){"use strict";function n(){return(n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}r.d(t,{Z:function(){return n}})},219:function(e,t,r){"use strict";function n(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r,n,a={},s=Object.keys(e);for(n=0;n<s.length;n++)r=s[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(n=0;n<s.length;n++)r=s[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}r.d(t,{Z:function(){return n}})}},function(e){e.O(0,[885,774,888,179],(function(){return t=1923,e(e.s=t);var t}));var t=e.O();_N_E=t}]);