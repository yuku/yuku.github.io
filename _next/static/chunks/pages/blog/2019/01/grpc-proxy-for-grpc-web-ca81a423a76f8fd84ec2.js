_N_E=(window.webpackJsonp_N_E=window.webpackJsonp_N_E||[]).push([[17],{"83p3":function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/blog/2019/01/grpc-proxy-for-grpc-web",function(){return r("h37B")}])},h37B:function(e,t,r){"use strict";r.r(t);var o=r("o0o1"),a=r.n(o),n=r("HaE+"),c=r("nKUr"),p=(r("q1tI"),r("Yp5c")),b=r("rePB"),i=r("Ff2n"),l=r("7ljp");function s(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function u(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?s(Object(r),!0).forEach((function(t){Object(b.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):s(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var h={};function O(e){var t=e.components,r=Object(i.a)(e,["components"]);return Object(l.a)("wrapper",u(u(u({},h),r),{},{components:t,mdxType:"MDXLayout"}),Object(l.a)("p",null,"When I read the gRPC-Web documentation, I was surprised to see ",Object(l.a)("a",u({parentName:"p"},{href:"https://www.envoyproxy.io/"}),"Envoy")," used without any explanation:"),Object(l.a)("blockquote",null,Object(l.a)("p",{parentName:"blockquote"},"In this example, we will use the ",Object(l.a)("a",u({parentName:"p"},{href:"https://www.envoyproxy.io/"}),"Envoy")," proxy to forward the gRPC browser request to the backend server. - ",Object(l.a)("a",u({parentName:"p"},{href:"https://grpc.io/docs/tutorials/basic/web.html"}),"gRPC Basics - Web"))),Object(l.a)("p",null,"gRPC uses HTTP2. Since modern browsers are able to communicate over HTTP2, I don't see the need to set up a proxy if I support only such browsers. Why do I need a proxy like Envoy nonetheless?"),Object(l.a)("h2",null,"Browser Restriction"),Object(l.a)("p",null,"There is a hint in the documentation describing the gRPC-Web protocol:"),Object(l.a)("blockquote",null,Object(l.a)("p",{parentName:"blockquote"},"decouple from HTTP/2 framing which is not, and will never, be directly exposed by browsers - ",Object(l.a)("a",u({parentName:"p"},{href:"https://github.com/grpc/grpc/blob/f0bfcd864c7a2395ad82ff9db8e39d0c51d49ee0/doc/PROTOCOL-WEB.md"}),"grpc/PROTOCOL-WEB.md at master \xb7 grpc/grpc"))),Object(l.a)("p",null,"In short:"),Object(l.a)("ul",null,Object(l.a)("li",{parentName:"ul"},"JavaScript running in the browser does not provide full control over HTTP2."),Object(l.a)("li",{parentName:"ul"},"The gRPC protocol uses features of HTTP/2 that cannot be controlled by JavaScript."),Object(l.a)("li",{parentName:"ul"},"So that a proxy is required.")),Object(l.a)("p",null,"And I think the restriction will never be removed."),Object(l.a)("h2",null,"Why Restricted?"),Object(l.a)("p",null,"Why am I so sure that browser will keep the restriction?"),Object(l.a)("p",null,"The reason can be explained by considering the position of HTTP2 in the public Web. HTTP/1.1 has been used on the Web for a long time. So you can expect your web servers to be able to communicate over HTTP/1.1. However, it is not clear whether they can communicate over HTTP2. Therefore, a browser uses HTTP2 if it can communicate with a web server over HTTP2, but otherwise, it will fall back to HTTP/1.1."),Object(l.a)("p",null,"Also, because of the concept of layered architecture, Web application must not know whether HTTP2 or HTTP/1.1 is used under the hood. This means HTTP/1.1 and HTTP2 must be able to be handled transparently so that browser will never provide a way to control a feature only available in HTTP2 by JavaScript."),Object(l.a)("p",null,"gRPC uses the such HTTP2-only feature."),Object(l.a)("h2",null,"References"),Object(l.a)("ul",null,Object(l.a)("li",{parentName:"ul"},Object(l.a)("a",u({parentName:"li"},{href:"https://github.com/grpc/grpc/blob/f0bfcd8/doc/PROTOCOL-WEB.md"}),"grpc/PROTOCOL-WEB.md \xb7 grpc/grpc")),Object(l.a)("li",{parentName:"ul"},Object(l.a)("a",u({parentName:"li"},{href:"https://github.com/grpc/grpc/blob/f0bfcd864c7a2395ad82ff9db8e39d0c51d49ee0/doc/PROTOCOL-HTTP2.md"}),"grpc/PROTOCOL-HTTP2.md \xb7 grpc/grpc")),Object(l.a)("li",{parentName:"ul"},Object(l.a)("a",u({parentName:"li"},{href:"https://github.com/grpc/grpc-web/issues/347"}),"Why is envoy proxy required? \xb7 Issue #347 \xb7 grpc/grpc-web")),Object(l.a)("li",{parentName:"ul"},Object(l.a)("a",u({parentName:"li"},{href:"https://github.com/k2wanko/gae-grpc-web"}),"k2wanko/gae-grpc-web: Example: gRPC Web on Google App Engine / Go"))))}O.isMDXComponent=!0;var d=function(e){var t=e.meta;return Object(c.jsx)(p.a,{meta:t,children:Object(c.jsx)(O,{})})};d.getInitialProps=Object(n.a)(a.a.mark((function e(){var t,o;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r("n1xW"),o=t.entries,e.abrupt("return",{meta:o["blog/2019/01/grpc-proxy-for-grpc-web"]});case 2:case"end":return e.stop()}}),e)})));t.default=d}},[["83p3",0,1,4,2,3,5,6]]]);