(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[342],{4696:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return m}});var o=r(809),n=r.n(o),a=r(5311),c=r(5893),p=(r(7294),r(7871)),i=r(6265),l=r(8347),s=r(3905);function u(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function b(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?u(Object(r),!0).forEach((function(t){(0,i.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):u(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var h={};function d(e){var t=e.components,r=(0,l.Z)(e,["components"]);return(0,s.kt)("wrapper",b(b(b({},h),r),{},{components:t,mdxType:"MDXLayout"}),(0,s.kt)("p",null,"When I read the gRPC-Web documentation, I was surprised to see ",(0,s.kt)("a",b({parentName:"p"},{href:"https://www.envoyproxy.io/"}),"Envoy")," used without any explanation:"),(0,s.kt)("blockquote",null,(0,s.kt)("p",{parentName:"blockquote"},"In this example, we will use the ",(0,s.kt)("a",b({parentName:"p"},{href:"https://www.envoyproxy.io/"}),"Envoy")," proxy to forward the gRPC browser request to the backend server. - ",(0,s.kt)("a",b({parentName:"p"},{href:"https://grpc.io/docs/tutorials/basic/web.html"}),"gRPC Basics - Web"))),(0,s.kt)("p",null,"gRPC uses HTTP2. Since modern browsers are able to communicate over HTTP2, I don't see the need to set up a proxy if I support only such browsers. Why do I need a proxy like Envoy nonetheless?"),(0,s.kt)("h2",null,"Browser Restriction"),(0,s.kt)("p",null,"There is a hint in the documentation describing the gRPC-Web protocol:"),(0,s.kt)("blockquote",null,(0,s.kt)("p",{parentName:"blockquote"},"decouple from HTTP/2 framing which is not, and will never, be directly exposed by browsers - ",(0,s.kt)("a",b({parentName:"p"},{href:"https://github.com/grpc/grpc/blob/f0bfcd864c7a2395ad82ff9db8e39d0c51d49ee0/doc/PROTOCOL-WEB.md"}),"grpc/PROTOCOL-WEB.md at master \xb7 grpc/grpc"))),(0,s.kt)("p",null,"In short:"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"JavaScript running in the browser does not provide full control over HTTP2."),(0,s.kt)("li",{parentName:"ul"},"The gRPC protocol uses features of HTTP/2 that cannot be controlled by JavaScript."),(0,s.kt)("li",{parentName:"ul"},"So that a proxy is required.")),(0,s.kt)("p",null,"And I think the restriction will never be removed."),(0,s.kt)("h2",null,"Why Restricted?"),(0,s.kt)("p",null,"Why am I so sure that browser will keep the restriction?"),(0,s.kt)("p",null,"The reason can be explained by considering the position of HTTP2 in the public Web. HTTP/1.1 has been used on the Web for a long time. So you can expect your web servers to be able to communicate over HTTP/1.1. However, it is not clear whether they can communicate over HTTP2. Therefore, a browser uses HTTP2 if it can communicate with a web server over HTTP2, but otherwise, it will fall back to HTTP/1.1."),(0,s.kt)("p",null,"Also, because of the concept of layered architecture, Web application must not know whether HTTP2 or HTTP/1.1 is used under the hood. This means HTTP/1.1 and HTTP2 must be able to be handled transparently so that browser will never provide a way to control a feature only available in HTTP2 by JavaScript."),(0,s.kt)("p",null,"gRPC uses the such HTTP2-only feature."),(0,s.kt)("h2",null,"References"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",b({parentName:"li"},{href:"https://github.com/grpc/grpc/blob/f0bfcd8/doc/PROTOCOL-WEB.md"}),"grpc/PROTOCOL-WEB.md \xb7 grpc/grpc")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",b({parentName:"li"},{href:"https://github.com/grpc/grpc/blob/f0bfcd864c7a2395ad82ff9db8e39d0c51d49ee0/doc/PROTOCOL-HTTP2.md"}),"grpc/PROTOCOL-HTTP2.md \xb7 grpc/grpc")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",b({parentName:"li"},{href:"https://github.com/grpc/grpc-web/issues/347"}),"Why is envoy proxy required? \xb7 Issue #347 \xb7 grpc/grpc-web")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",b({parentName:"li"},{href:"https://github.com/k2wanko/gae-grpc-web"}),"k2wanko/gae-grpc-web: Example: gRPC Web on Google App Engine / Go"))))}d.isMDXComponent=!0;var f=function(e){var t=e.meta;return(0,c.jsx)(p.i,{meta:t,children:(0,c.jsx)(d,{})})};f.getInitialProps=(0,a.Z)(n().mark((function e(){var t,o;return n().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r(405),o=t.entries,e.abrupt("return",{meta:o["blog/2019/01/grpc-proxy-for-grpc-web"]});case 2:case"end":return e.stop()}}),e)})));var m=f},9168:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/blog/2019/01/grpc-proxy-for-grpc-web",function(){return r(4696)}])}},function(e){e.O(0,[885,663,774,888,179],(function(){return t=9168,e(e.s=t);var t}));var t=e.O();_N_E=t}]);