<!DOCTYPE html><html prefix="og: http://ogp.me/ns#"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><link rel="apple-touch-icon" sizes="57x57" href="/static/icons/apple-icon-57x57.png"/><link rel="apple-touch-icon" sizes="60x60" href="/static/icons/apple-icon-60x60.png"/><link rel="apple-touch-icon" sizes="72x72" href="/static/icons/apple-icon-72x72.png"/><link rel="apple-touch-icon" sizes="76x76" href="/static/icons/apple-icon-76x76.png"/><link rel="apple-touch-icon" sizes="114x114" href="/static/icons/apple-icon-114x114.png"/><link rel="apple-touch-icon" sizes="120x120" href="/static/icons/apple-icon-120x120.png"/><link rel="apple-touch-icon" sizes="144x144" href="/static/icons/apple-icon-144x144.png"/><link rel="apple-touch-icon" sizes="152x152" href="/static/icons/apple-icon-152x152.png"/><link rel="apple-touch-icon" sizes="180x180" href="/static/icons/apple-icon-180x180.png"/><link rel="icon" type="image/png" sizes="192x192" href="/static/icons/android-icon-192x192.png"/><link rel="icon" type="image/png" sizes="32x32" href="/static/icons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="96x96" href="/static/icons/favicon-96x96.png"/><link rel="icon" type="image/png" sizes="16x16" href="/static/icons/favicon-16x16.png"/><link rel="icon" href="/static/icons/favicon.ico"/><link rel="manifest" href="/static/config/manifest.json"/><meta name="msapplication-TileColor" content="#00BCD4"/><meta name="msapplication-TileImage" content="/static/icons/ms-icon-144x144.png"/><meta name="msapplication-config" content="/static/config/browserconfig.xml"/><meta name="google-site-verification" content="uoCr1A890A-K8B7GkFUvLlQ5ihZlFyR6gzvt4F-62u0"/><link href="https://fonts.googleapis.com/css?family=Noto+Sans+JP:300,400,700|Damion" rel="stylesheet"/><link rel="alternate" type="application/rss+xml" href="/static/rss-feed.xml"/><title>Matrix Factorization のための ALS アルゴリズムの数理と実装 - yt coffee</title><meta name="description" content="協調フィルタリングで広く使われる MF の実装の一つである ALS アルゴリズムの数学的な背景を確認し、 Julia を使って実装する。"/><meta name="twitter:card" content="summary"/><meta name="twitter:creator" content="@yuku_t"/><meta property="fb:app_id" content="1188125924685915"/><meta property="og:title" content="Matrix Factorization のための ALS アルゴリズムの数理と実装 - yt coffee"/><meta property="og:type" content="article"/><meta property="og:url" content="https://yuku.takahashi.coffee/blog/2020/01/als-for-matrix-factorization"/><meta property="og:image" content="https://yuku.takahashi.coffee/static/images/haniwa.jpg"/><meta property="og:description" content="協調フィルタリングで広く使われる MF の実装の一つである ALS アルゴリズムの数学的な背景を確認し、 Julia を使って実装する。"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.15.0/themes/prism.min.css"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css"/><meta name="next-head-count" content="35"/><link rel="preload" href="/_next/static/css/37dc55971eb8a36424bb.css" as="style"/><link rel="stylesheet" href="/_next/static/css/37dc55971eb8a36424bb.css" data-n-g=""/><noscript data-n-css=""></noscript><link rel="preload" href="/_next/static/chunks/main-75bd50777575514fc5f3.js" as="script"/><link rel="preload" href="/_next/static/chunks/webpack-50bee04d1dc61f8adf5b.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.ae55bf7e6c20d673e3c3.js" as="script"/><link rel="preload" href="/_next/static/chunks/a9a7754c.c8764ee11937355f24a2.js" as="script"/><link rel="preload" href="/_next/static/chunks/cb1608f2.e00f163fcc55cfdbda67.js" as="script"/><link rel="preload" href="/_next/static/chunks/f49d73988a24b1a368deb881432b3c745a8ffbf3.97290e5451f6acb178cd.js" as="script"/><link rel="preload" href="/_next/static/chunks/b7332b03a5404fa9d49d0c74802b2933c91d9989.68e21dee9072a78dd756.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-c8c98de076f140808cb7.js" as="script"/><link rel="preload" href="/_next/static/chunks/75fc9c18.60c1ab7504f6eb9ff2f2.js" as="script"/><link rel="preload" href="/_next/static/chunks/617355b6010ccfcb4c6aa531bf90c08da739fc7f.98df9cb45d4979d93192.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/blog/2020/01/als-for-matrix-factorization-92dcdccccfaa92f55f4e.js" as="script"/></head><body><div id="__next"><div class="layout mx-md-auto d-md-flex"><nav class="topbar-mobile d-flex justify-content-between d-md-none py-4 px-3"><a href="/" class="brand">yt coffee</a><button class="border-0 bg-transparent text-black-50"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="bars" class="svg-inline--fa fa-bars fa-w-14 " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M16 132h416c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H16C7.163 60 0 67.163 0 76v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"></path></svg></button></nav><div class="side-menu d-md-block px-3 p-lg-5 py-4"><div class="side-menu-inner"><a href="/" class="brand">yt coffee</a><p class="text-muted font-weight-light pt-1"><small>Study hard, play harder.</small></p><ul class="list list-unstyled"><li class=""><a href="/">Home</a></li><li class=""><a href="/showcase">Showcase</a></li><li class=""><a href="/about">About Me</a></li><li class=""><a href="/resume">Resume</a></li></ul></div></div><div class="flex-md-grow-1 bg-white px-sm-3 pt-lg-5 py-4 overflow-hidden"><div class="blogpage container"><div class="row"><main class="col-xl-8 notebook"><article itemscope="" itemType="http://schema.org/BlogPosting"><meta itemProp="author" content="Yuku Takahashi"/><meta itemProp="datePublished" content="2020-01-06T10:09:00+09:00"/><meta itemProp="dateModified" content="2020-01-06T10:33:00+09:00"/><meta itemProp="image" content="https://yuku.takahashi.coffee/static/images/haniwa.jpg"/><header class="mb-4 header"><h1 class="headline" itemProp="headline">Matrix Factorization のための ALS アルゴリズムの数理と実装</h1><ul class="list-inline text-dark font-weight-light"><li class="list-inline-item"><span class="ml-1">2020-01-06 01:09</span></li><li class="list-inline-item"><span class="ml-1">#<!-- -->julia</span></li></ul></header><section class="mb-4 body" itemProp="articleBody"><div class="nb-notebook"><div class="nb-worksheet"><div class="nb-cell nb-markdown-cell"><p>Apache Spark の mllib には情報推薦でよく使われる Matrix Factorization （以下 MF）を計算するための ALS アルゴリズムが実装されています。 MF は直感的に理解しやすいモデルですし、 Spark を使えば大規模な user-item 行列にも適用できるのですが、実際に ALS がどういうアルゴリズムなのか知って使うのか、それともブラックボックスとして使うのかでは大きな違いがある、というのが個人的な考えです。</p><p>というわけでこの記事では <a href="https://endymecy.gitbooks.io/spark-ml-source-analysis/content/%E6%8E%A8%E8%8D%90/papers/Large-scale%20Parallel%20Collaborative%20Filtering%20the%20Netflix%20Prize.pdf">Large-scale Parallel Collaborative Filtering for the Netflix Prize</a> を参考に ALS が内部で何をしているのかを確認してから、実際に実装してみたいと思います。</p></div><div class="nb-cell nb-markdown-cell"><h2>MF の数理</h2><p>MF ではレーティング行列２つの行列 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow><mi>P</mi></mrow>P</math></span><span aria-hidden="true" class="katex-html"><span class="base"><span style="height:0.68333em;vertical-align:0em" class="strut"></span><span style="margin-right:0.13889em" class="mord mathnormal">P</span></span></span></span></span> と <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow><mi>Q</mi></mrow>Q</math></span><span aria-hidden="true" class="katex-html"><span class="base"><span style="height:0.8777699999999999em;vertical-align:-0.19444em" class="strut"></span><span class="mord mathnormal">Q</span></span></span></span></span> で近似します。</p><div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><mrow><mi>R</mi><mo>≈</mo><mi>P</mi><mo>×</mo><msup><mi>Q</mi><mi mathvariant="normal">T</mi></msup><mo>=</mo><mover accent="true"><mi>R</mi><mo>^</mo></mover></mrow>R \approx P \times Q^\mathrm<!-- -->{<!-- -->T<!-- -->}<!-- --> = \hat<!-- -->{<!-- -->R<!-- -->}</math></span><span aria-hidden="true" class="katex-html"><span class="base"><span style="height:0.68333em;vertical-align:0em" class="strut"></span><span style="margin-right:0.00773em" class="mord mathnormal">R</span><span style="margin-right:0.2777777777777778em" class="mspace"></span><span class="mrel">≈</span><span style="margin-right:0.2777777777777778em" class="mspace"></span></span><span class="base"><span style="height:0.76666em;vertical-align:-0.08333em" class="strut"></span><span style="margin-right:0.13889em" class="mord mathnormal">P</span><span style="margin-right:0.2222222222222222em" class="mspace"></span><span class="mbin">×</span><span style="margin-right:0.2222222222222222em" class="mspace"></span></span><span class="base"><span style="height:1.0857709999999998em;vertical-align:-0.19444em" class="strut"></span><span class="mord"><span class="mord mathnormal">Q</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span style="height:0.8913309999999999em" class="vlist"><span style="top:-3.113em;margin-right:0.05em"><span style="height:2.7em" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight">T</span></span></span></span></span></span></span></span></span><span style="margin-right:0.2777777777777778em" class="mspace"></span><span class="mrel">=</span><span style="margin-right:0.2777777777777778em" class="mspace"></span></span><span class="base"><span style="height:0.9467699999999999em;vertical-align:0em" class="strut"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span style="height:0.9467699999999999em" class="vlist"><span style="top:-3em"><span style="height:3em" class="pstrut"></span><span class="mord"><span style="margin-right:0.00773em" class="mord mathnormal">R</span></span></span><span style="top:-3.25233em"><span style="height:3em" class="pstrut"></span><span style="left:-0.16666em" class="accent-body"><span class="mord">^</span></span></span></span></span></span></span></span></span></span></span></div><p>ユーザの総数を <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow><mi mathvariant="normal">∣</mi><mi>U</mi><mi mathvariant="normal">∣</mi></mrow>|U|</math></span><span aria-hidden="true" class="katex-html"><span class="base"><span style="height:1em;vertical-align:-0.25em" class="strut"></span><span class="mord">∣</span><span style="margin-right:0.10903em" class="mord mathnormal">U</span><span class="mord">∣</span></span></span></span></span>、 商品の総数を <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow><mi mathvariant="normal">∣</mi><mi>D</mi><mi mathvariant="normal">∣</mi></mrow>|D|</math></span><span aria-hidden="true" class="katex-html"><span class="base"><span style="height:1em;vertical-align:-0.25em" class="strut"></span><span class="mord">∣</span><span style="margin-right:0.02778em" class="mord mathnormal">D</span><span class="mord">∣</span></span></span></span></span> とすると <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow><mi>P</mi></mrow>P</math></span><span aria-hidden="true" class="katex-html"><span class="base"><span style="height:0.68333em;vertical-align:0em" class="strut"></span><span style="margin-right:0.13889em" class="mord mathnormal">P</span></span></span></span></span> と <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow><mi>Q</mi></mrow>Q</math></span><span aria-hidden="true" class="katex-html"><span class="base"><span style="height:0.8777699999999999em;vertical-align:-0.19444em" class="strut"></span><span class="mord mathnormal">Q</span></span></span></span></span> はそれぞれ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow><mi mathvariant="normal">∣</mi><mi>U</mi><mi mathvariant="normal">∣</mi><mo>×</mo><mi>K</mi></mrow>|U| \times K</math></span><span aria-hidden="true" class="katex-html"><span class="base"><span style="height:1em;vertical-align:-0.25em" class="strut"></span><span class="mord">∣</span><span style="margin-right:0.10903em" class="mord mathnormal">U</span><span class="mord">∣</span><span style="margin-right:0.2222222222222222em" class="mspace"></span><span class="mbin">×</span><span style="margin-right:0.2222222222222222em" class="mspace"></span></span><span class="base"><span style="height:0.68333em;vertical-align:0em" class="strut"></span><span style="margin-right:0.07153em" class="mord mathnormal">K</span></span></span></span></span> 行列と <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow><mi mathvariant="normal">∣</mi><mi>D</mi><mi mathvariant="normal">∣</mi><mo>×</mo><mi>K</mi></mrow>|D| \times K</math></span><span aria-hidden="true" class="katex-html"><span class="base"><span style="height:1em;vertical-align:-0.25em" class="strut"></span><span class="mord">∣</span><span style="margin-right:0.02778em" class="mord mathnormal">D</span><span class="mord">∣</span><span style="margin-right:0.2222222222222222em" class="mspace"></span><span class="mbin">×</span><span style="margin-right:0.2222222222222222em" class="mspace"></span></span><span class="base"><span style="height:0.68333em;vertical-align:0em" class="strut"></span><span style="margin-right:0.07153em" class="mord mathnormal">K</span></span></span></span></span> 行列となります。このとき <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow><mi>K</mi></mrow>K</math></span><span aria-hidden="true" class="katex-html"><span class="base"><span style="height:0.68333em;vertical-align:0em" class="strut"></span><span style="margin-right:0.07153em" class="mord mathnormal">K</span></span></span></span></span> はモデルに与えられるパラメータで潜在因子の数を表します。</p><p>このときユーザ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow><mi>u</mi></mrow>u</math></span><span aria-hidden="true" class="katex-html"><span class="base"><span style="height:0.43056em;vertical-align:0em" class="strut"></span><span class="mord mathnormal">u</span></span></span></span></span> の商品 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow><mi>i</mi></mrow>i</math></span><span aria-hidden="true" class="katex-html"><span class="base"><span style="height:0.65952em;vertical-align:0em" class="strut"></span><span class="mord mathnormal">i</span></span></span></span></span> に対するレーティングの推定値 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow><msub><mover accent="true"><mi>r</mi><mo>^</mo></mover><mrow><mi>u</mi><mi>i</mi></mrow></msub></mrow>\hat<!-- -->{<!-- -->r<!-- -->}<!-- -->_<!-- -->{<!-- -->ui<!-- -->}</math></span><span aria-hidden="true" class="katex-html"><span class="base"><span style="height:0.84444em;vertical-align:-0.15em" class="strut"></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span style="height:0.69444em" class="vlist"><span style="top:-3em"><span style="height:3em" class="pstrut"></span><span class="mord"><span style="margin-right:0.02778em" class="mord mathnormal">r</span></span></span><span style="top:-3em"><span style="height:3em" class="pstrut"></span><span style="left:-0.19444em" class="accent-body"><span class="mord">^</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:0.31166399999999994em" class="vlist"><span style="top:-2.5500000000000003em;margin-right:0.05em"><span style="height:2.7em" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">u</span><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.15em" class="vlist"><span></span></span></span></span></span></span></span></span></span></span> は</p><div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><mrow><msub><mover accent="true"><mi>r</mi><mo>^</mo></mover><mrow><mi>u</mi><mi>i</mi></mrow></msub><mo>=</mo><msubsup><mi mathvariant="bold">p</mi><mi>u</mi><mi mathvariant="normal">T</mi></msubsup><msub><mi mathvariant="bold">q</mi><mi>i</mi></msub></mrow>\hat<!-- -->{<!-- -->r<!-- -->}<!-- -->_<!-- -->{<!-- -->ui<!-- -->}<!-- --> = \mathbf<!-- -->{<!-- -->p<!-- -->}<!-- -->_u^\mathrm<!-- -->{<!-- -->T<!-- -->}<!-- --> \mathbf<!-- -->{<!-- -->q<!-- -->}<!-- -->_i</math></span><span aria-hidden="true" class="katex-html"><span class="base"><span style="height:0.84444em;vertical-align:-0.15em" class="strut"></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span style="height:0.69444em" class="vlist"><span style="top:-3em"><span style="height:3em" class="pstrut"></span><span class="mord"><span style="margin-right:0.02778em" class="mord mathnormal">r</span></span></span><span style="top:-3em"><span style="height:3em" class="pstrut"></span><span style="left:-0.19444em" class="accent-body"><span class="mord">^</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:0.31166399999999994em" class="vlist"><span style="top:-2.5500000000000003em;margin-right:0.05em"><span style="height:2.7em" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">u</span><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.15em" class="vlist"><span></span></span></span></span></span></span><span style="margin-right:0.2777777777777778em" class="mspace"></span><span class="mrel">=</span><span style="margin-right:0.2777777777777778em" class="mspace"></span></span><span class="base"><span style="height:1.138331em;vertical-align:-0.247em" class="strut"></span><span class="mord"><span class="mord"><span class="mord mathbf">p</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:0.8913309999999999em" class="vlist"><span style="top:-2.4530000000000003em;margin-right:0.05em"><span style="height:2.7em" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">u</span></span></span><span style="top:-3.113em;margin-right:0.05em"><span style="height:2.7em" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight">T</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.247em" class="vlist"><span></span></span></span></span></span></span><span class="mord"><span class="mord"><span class="mord mathbf">q</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:0.31166399999999994em" class="vlist"><span style="top:-2.5500000000000003em;margin-right:0.05em"><span style="height:2.7em" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.15em" class="vlist"><span></span></span></span></span></span></span></span></span></span></span></div><p>で与えられます。 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow><mi>P</mi></mrow>P</math></span><span aria-hidden="true" class="katex-html"><span class="base"><span style="height:0.68333em;vertical-align:0em" class="strut"></span><span style="margin-right:0.13889em" class="mord mathnormal">P</span></span></span></span></span> と <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow><mi>Q</mi></mrow>Q</math></span><span aria-hidden="true" class="katex-html"><span class="base"><span style="height:0.8777699999999999em;vertical-align:-0.19444em" class="strut"></span><span class="mord mathnormal">Q</span></span></span></span></span> を計算するには、 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow><mi>I</mi></mrow>I</math></span><span aria-hidden="true" class="katex-html"><span class="base"><span style="height:0.68333em;vertical-align:0em" class="strut"></span><span style="margin-right:0.07847em" class="mord mathnormal">I</span></span></span></span></span> を <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow><mi>R</mi></mrow>R</math></span><span aria-hidden="true" class="katex-html"><span class="base"><span style="height:0.68333em;vertical-align:0em" class="strut"></span><span style="margin-right:0.00773em" class="mord mathnormal">R</span></span></span></span></span> の中で実際に値が与えられている <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow><mi>u</mi></mrow>u</math></span><span aria-hidden="true" class="katex-html"><span class="base"><span style="height:0.43056em;vertical-align:0em" class="strut"></span><span class="mord mathnormal">u</span></span></span></span></span> と <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow><mi>i</mi></mrow>i</math></span><span aria-hidden="true" class="katex-html"><span class="base"><span style="height:0.65952em;vertical-align:0em" class="strut"></span><span class="mord mathnormal">i</span></span></span></span></span> の組を表すとして、二乗誤差に L1 正則化を加えた</p><div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><mrow><mi>L</mi><mo>=</mo><munder><mo>∑</mo><mrow><mo stretchy="false">(</mo><mi>u</mi><mo separator="true">,</mo><mi>i</mi><mo stretchy="false">)</mo><mo>∈</mo><mi>I</mi></mrow></munder><mo stretchy="false">(</mo><msub><mi>r</mi><mrow><mi>u</mi><mi>i</mi></mrow></msub><mo>−</mo><msub><mover accent="true"><mi>r</mi><mo>^</mo></mover><mrow><mi>u</mi><mi>i</mi></mrow></msub><msup><mo stretchy="false">)</mo><mn>2</mn></msup><mo>+</mo><mi>α</mi><mi mathvariant="normal">∥</mi><mi>P</mi><mi mathvariant="normal">∥</mi><mo>+</mo><mi>β</mi><mi mathvariant="normal">∥</mi><mi>Q</mi><mi mathvariant="normal">∥</mi></mrow>L = \sum_<!-- -->{<!-- -->(u, i) \in I<!-- -->}<!-- --> (r_<!-- -->{<!-- -->ui<!-- -->}<!-- --> - \hat<!-- -->{<!-- -->r<!-- -->}<!-- -->_<!-- -->{<!-- -->ui<!-- -->}<!-- -->)^2 + \alpha \|P\| + \beta \|Q\|</math></span><span aria-hidden="true" class="katex-html"><span class="base"><span style="height:0.68333em;vertical-align:0em" class="strut"></span><span class="mord mathnormal">L</span><span style="margin-right:0.2777777777777778em" class="mspace"></span><span class="mrel">=</span><span style="margin-right:0.2777777777777778em" class="mspace"></span></span><span class="base"><span style="height:2.5660100000000003em;vertical-align:-1.516005em" class="strut"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:1.050005em" class="vlist"><span style="top:-1.808995em;margin-left:0em"><span style="height:3.05em" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">u</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span><span class="mrel mtight">∈</span><span style="margin-right:0.07847em" class="mord mathnormal mtight">I</span></span></span></span><span style="top:-3.0500049999999996em"><span style="height:3.05em" class="pstrut"></span><span><span class="mop op-symbol large-op">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:1.516005em" class="vlist"><span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span style="margin-right:0.02778em" class="mord mathnormal">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:0.31166399999999994em" class="vlist"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em"><span style="height:2.7em" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">u</span><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.15em" class="vlist"><span></span></span></span></span></span></span><span style="margin-right:0.2222222222222222em" class="mspace"></span><span class="mbin">−</span><span style="margin-right:0.2222222222222222em" class="mspace"></span></span><span class="base"><span style="height:1.1141079999999999em;vertical-align:-0.25em" class="strut"></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span style="height:0.69444em" class="vlist"><span style="top:-3em"><span style="height:3em" class="pstrut"></span><span class="mord"><span style="margin-right:0.02778em" class="mord mathnormal">r</span></span></span><span style="top:-3em"><span style="height:3em" class="pstrut"></span><span style="left:-0.19444em" class="accent-body"><span class="mord">^</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:0.31166399999999994em" class="vlist"><span style="top:-2.5500000000000003em;margin-right:0.05em"><span style="height:2.7em" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">u</span><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.15em" class="vlist"><span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span style="height:0.8641079999999999em" class="vlist"><span style="top:-3.113em;margin-right:0.05em"><span style="height:2.7em" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span style="margin-right:0.2222222222222222em" class="mspace"></span><span class="mbin">+</span><span style="margin-right:0.2222222222222222em" class="mspace"></span></span><span class="base"><span style="height:1em;vertical-align:-0.25em" class="strut"></span><span style="margin-right:0.0037em" class="mord mathnormal">α</span><span class="mord">∥</span><span style="margin-right:0.13889em" class="mord mathnormal">P</span><span class="mord">∥</span><span style="margin-right:0.2222222222222222em" class="mspace"></span><span class="mbin">+</span><span style="margin-right:0.2222222222222222em" class="mspace"></span></span><span class="base"><span style="height:1em;vertical-align:-0.25em" class="strut"></span><span style="margin-right:0.05278em" class="mord mathnormal">β</span><span class="mord">∥</span><span class="mord mathnormal">Q</span><span class="mord">∥</span></span></span></span></span></div><p>を損失関数として最小化する方法があります。このアルゴリズムは 2006 年の <a href="https://www.netflixprize.com/">Netflix Prize</a> で Simon Funk によって提案されたので、一般的に <strong>Funk SVD</strong> と呼ばれています。</p><p>Funk SVD は単一のコンピュータ上で計算するには適していますが、スケーラビリティに問題がありました。今日ではテラバイトあるいはペタバイトという大きなのデータを扱うこともあるので、そのような規模のデータを一つのマシンで処理するのは大変です。</p></div><div class="nb-cell nb-markdown-cell"><h2>Alternating Least Square (ALS)</h2><p>スケーラビリティを改善するために提案されたのが ALS です。 ALS では L2 正則化を行います。</p><div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><mrow><mi>L</mi><mo>=</mo><munder><mo>∑</mo><mrow><mo stretchy="false">(</mo><mi>u</mi><mo separator="true">,</mo><mi>i</mi><mo stretchy="false">)</mo><mo>∈</mo><mi>I</mi></mrow></munder><mo stretchy="false">(</mo><msub><mi>r</mi><mrow><mi>u</mi><mi>i</mi></mrow></msub><mo>−</mo><msubsup><mi mathvariant="bold">p</mi><mi>u</mi><mi mathvariant="normal">T</mi></msubsup><msub><mi mathvariant="bold">q</mi><mi>i</mi></msub><msup><mo stretchy="false">)</mo><mn>2</mn></msup><mo>+</mo><mi>λ</mi><mo fence="true">(</mo><munder><mo>∑</mo><mi>u</mi></munder><msub><mi>n</mi><msub><mi>p</mi><mi>u</mi></msub></msub><mi mathvariant="normal">∥</mi><msub><mi mathvariant="bold">p</mi><mi>u</mi></msub><msup><mi mathvariant="normal">∥</mi><mn>2</mn></msup><mo>+</mo><munder><mo>∑</mo><mi>i</mi></munder><msub><mi>n</mi><msub><mi>q</mi><mi>i</mi></msub></msub><mi mathvariant="normal">∥</mi><msub><mi mathvariant="bold">q</mi><mi>i</mi></msub><msup><mi mathvariant="normal">∥</mi><mn>2</mn></msup><mo fence="true">)</mo></mrow>L = \sum_<!-- -->{<!-- -->(u,i) \in I<!-- -->}<!-- --> (r_<!-- -->{<!-- -->ui<!-- -->}<!-- --> - \mathbf<!-- -->{<!-- -->p<!-- -->}<!-- -->_u^\mathrm<!-- -->{<!-- -->T<!-- -->}<!-- -->\mathbf<!-- -->{<!-- -->q<!-- -->}<!-- -->_i)^2 + \lambda \Biggl(\sum_u n_<!-- -->{<!-- -->p_u<!-- -->}<!-- -->\|\mathbf<!-- -->{<!-- -->p<!-- -->}<!-- -->_u\|^2 + \sum_i n_<!-- -->{<!-- -->q_i<!-- -->}<!-- -->\|\mathbf<!-- -->{<!-- -->q<!-- -->}<!-- -->_i\|^2\Biggr)</math></span><span aria-hidden="true" class="katex-html"><span class="base"><span style="height:0.68333em;vertical-align:0em" class="strut"></span><span class="mord mathnormal">L</span><span style="margin-right:0.2777777777777778em" class="mspace"></span><span class="mrel">=</span><span style="margin-right:0.2777777777777778em" class="mspace"></span></span><span class="base"><span style="height:2.5660100000000003em;vertical-align:-1.516005em" class="strut"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:1.050005em" class="vlist"><span style="top:-1.808995em;margin-left:0em"><span style="height:3.05em" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">u</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">i</span><span class="mclose mtight">)</span><span class="mrel mtight">∈</span><span style="margin-right:0.07847em" class="mord mathnormal mtight">I</span></span></span></span><span style="top:-3.0500049999999996em"><span style="height:3.05em" class="pstrut"></span><span><span class="mop op-symbol large-op">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:1.516005em" class="vlist"><span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span style="margin-right:0.02778em" class="mord mathnormal">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:0.31166399999999994em" class="vlist"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em"><span style="height:2.7em" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">u</span><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.15em" class="vlist"><span></span></span></span></span></span></span><span style="margin-right:0.2222222222222222em" class="mspace"></span><span class="mbin">−</span><span style="margin-right:0.2222222222222222em" class="mspace"></span></span><span class="base"><span style="height:1.1413309999999999em;vertical-align:-0.25em" class="strut"></span><span class="mord"><span class="mord"><span class="mord mathbf">p</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:0.8913309999999999em" class="vlist"><span style="top:-2.4530000000000003em;margin-right:0.05em"><span style="height:2.7em" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">u</span></span></span><span style="top:-3.113em;margin-right:0.05em"><span style="height:2.7em" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight">T</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.247em" class="vlist"><span></span></span></span></span></span></span><span class="mord"><span class="mord"><span class="mord mathbf">q</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:0.31166399999999994em" class="vlist"><span style="top:-2.5500000000000003em;margin-right:0.05em"><span style="height:2.7em" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.15em" class="vlist"><span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span style="height:0.8641079999999999em" class="vlist"><span style="top:-3.113em;margin-right:0.05em"><span style="height:2.7em" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span style="margin-right:0.2222222222222222em" class="mspace"></span><span class="mbin">+</span><span style="margin-right:0.2222222222222222em" class="mspace"></span></span><span class="base"><span style="height:3.0000299999999998em;vertical-align:-1.25003em" class="strut"></span><span class="mord mathnormal">λ</span><span class="mopen"><span class="delimsizing size4">(</span></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:1.050005em" class="vlist"><span style="top:-1.8999949999999999em;margin-left:0em"><span style="height:3.05em" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">u</span></span></span><span style="top:-3.0500049999999996em"><span style="height:3.05em" class="pstrut"></span><span><span class="mop op-symbol large-op">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:1.250005em" class="vlist"><span></span></span></span></span></span><span style="margin-right:0.16666666666666666em" class="mspace"></span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:0.15139200000000003em" class="vlist"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em"><span style="height:2.7em" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:0.16454285714285719em" class="vlist"><span style="top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em"><span style="height:2.5em" class="pstrut"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">u</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.143em" class="vlist"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.286108em" class="vlist"><span></span></span></span></span></span></span><span class="mord">∥</span><span class="mord"><span class="mord"><span class="mord mathbf">p</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:0.151392em" class="vlist"><span style="top:-2.5500000000000003em;margin-right:0.05em"><span style="height:2.7em" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">u</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.15em" class="vlist"><span></span></span></span></span></span></span><span class="mord"><span class="mord">∥</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span style="height:0.8641079999999999em" class="vlist"><span style="top:-3.113em;margin-right:0.05em"><span style="height:2.7em" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span style="margin-right:0.2222222222222222em" class="mspace"></span><span class="mbin">+</span><span style="margin-right:0.2222222222222222em" class="mspace"></span></span><span class="base"><span style="height:3.027669em;vertical-align:-1.277669em" class="strut"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:1.0500050000000003em" class="vlist"><span style="top:-1.872331em;margin-left:0em"><span style="height:3.05em" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span><span style="top:-3.050005em"><span style="height:3.05em" class="pstrut"></span><span><span class="mop op-symbol large-op">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:1.277669em" class="vlist"><span></span></span></span></span></span><span style="margin-right:0.16666666666666666em" class="mspace"></span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:0.15139200000000003em" class="vlist"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em"><span style="height:2.7em" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span style="margin-right:0.03588em" class="mord mathnormal mtight">q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:0.3280857142857143em" class="vlist"><span style="top:-2.357em;margin-left:-0.03588em;margin-right:0.07142857142857144em"><span style="height:2.5em" class="pstrut"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.143em" class="vlist"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.286108em" class="vlist"><span></span></span></span></span></span></span><span class="mord">∥</span><span class="mord"><span class="mord"><span class="mord mathbf">q</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:0.31166399999999994em" class="vlist"><span style="top:-2.5500000000000003em;margin-right:0.05em"><span style="height:2.7em" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.15em" class="vlist"><span></span></span></span></span></span></span><span class="mord"><span class="mord">∥</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span style="height:0.8641079999999999em" class="vlist"><span style="top:-3.113em;margin-right:0.05em"><span style="height:2.7em" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing size4">)</span></span></span></span></span></span></div><p>ここで <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow><msub><mi>n</mi><msub><mi>p</mi><mi>u</mi></msub></msub></mrow>n_<!-- -->{<!-- -->p_u<!-- -->}</math></span><span aria-hidden="true" class="katex-html"><span class="base"><span style="height:0.716668em;vertical-align:-0.286108em" class="strut"></span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:0.15139200000000003em" class="vlist"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em"><span style="height:2.7em" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:0.16454285714285719em" class="vlist"><span style="top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em"><span style="height:2.5em" class="pstrut"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">u</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.143em" class="vlist"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.286108em" class="vlist"><span></span></span></span></span></span></span></span></span></span></span> と <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow><msub><mi>n</mi><msub><mi>q</mi><mi>i</mi></msub></msub></mrow>n_<!-- -->{<!-- -->q_i<!-- -->}</math></span><span aria-hidden="true" class="katex-html"><span class="base"><span style="height:0.716668em;vertical-align:-0.286108em" class="strut"></span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:0.15139200000000003em" class="vlist"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em"><span style="height:2.7em" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span style="margin-right:0.03588em" class="mord mathnormal mtight">q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:0.3280857142857143em" class="vlist"><span style="top:-2.357em;margin-left:-0.03588em;margin-right:0.07142857142857144em"><span style="height:2.5em" class="pstrut"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.143em" class="vlist"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.286108em" class="vlist"><span></span></span></span></span></span></span></span></span></span></span> はそれぞれユーザ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow><mi>u</mi></mrow>u</math></span><span aria-hidden="true" class="katex-html"><span class="base"><span style="height:0.43056em;vertical-align:0em" class="strut"></span><span class="mord mathnormal">u</span></span></span></span></span> と商品 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow><mi>i</mi></mrow>i</math></span><span aria-hidden="true" class="katex-html"><span class="base"><span style="height:0.65952em;vertical-align:0em" class="strut"></span><span class="mord mathnormal">i</span></span></span></span></span> のレーティングの数を表します。また <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow><msub><mi>I</mi><mi>u</mi></msub></mrow>I_u</math></span><span aria-hidden="true" class="katex-html"><span class="base"><span style="height:0.83333em;vertical-align:-0.15em" class="strut"></span><span class="mord"><span style="margin-right:0.07847em" class="mord mathnormal">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:0.151392em" class="vlist"><span style="top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em"><span style="height:2.7em" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">u</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.15em" class="vlist"><span></span></span></span></span></span></span></span></span></span></span> がユーザ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow><mi>u</mi></mrow>u</math></span><span aria-hidden="true" class="katex-html"><span class="base"><span style="height:0.43056em;vertical-align:0em" class="strut"></span><span class="mord mathnormal">u</span></span></span></span></span> が評価した商品の集合です。この損失関数を <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow><msub><mi>p</mi><mrow><mi>u</mi><mi>k</mi></mrow></msub></mrow>p_<!-- -->{<!-- -->uk<!-- -->}</math></span><span aria-hidden="true" class="katex-html"><span class="base"><span style="height:0.625em;vertical-align:-0.19444em" class="strut"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:0.33610799999999996em" class="vlist"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em"><span style="height:2.7em" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">u</span><span style="margin-right:0.03148em" class="mord mathnormal mtight">k</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.15em" class="vlist"><span></span></span></span></span></span></span></span></span></span></span> で偏微分してみると：</p><div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><mtable rowspacing="0.24999999999999992em"><mtr><mtd><mstyle displaystyle="true" scriptlevel="0"><mrow><mfrac><mn>1</mn><mn>2</mn></mfrac><mfrac><mrow><mi mathvariant="normal">∂</mi><mi>L</mi></mrow><mrow><mi mathvariant="normal">∂</mi><msub><mi>p</mi><mrow><mi>u</mi><mi>k</mi></mrow></msub></mrow></mfrac></mrow></mstyle></mtd><mtd><mstyle displaystyle="true" scriptlevel="0"><mrow><mrow></mrow><mo>=</mo><munder><mo>∑</mo><mrow><mi>i</mi><mo>∈</mo><msub><mi>I</mi><mi>u</mi></msub></mrow></munder><mo stretchy="false">(</mo><msubsup><mi mathvariant="bold">p</mi><mi>u</mi><mi mathvariant="normal">T</mi></msubsup><msub><mi mathvariant="bold">q</mi><mi>i</mi></msub><mo>−</mo><msub><mi>r</mi><mrow><mi>u</mi><mi>i</mi></mrow></msub><mo stretchy="false">)</mo><msub><mi>q</mi><mrow><mi>i</mi><mi>k</mi></mrow></msub><mo>+</mo><mi>λ</mi><msub><mi>n</mi><msub><mi>p</mi><mi>u</mi></msub></msub><msub><mi>p</mi><mrow><mi>k</mi><mi>u</mi></mrow></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle displaystyle="true" scriptlevel="0"><mrow></mrow></mstyle></mtd><mtd><mstyle displaystyle="true" scriptlevel="0"><mrow><mrow></mrow><mo>=</mo><munder><mo>∑</mo><mrow><mi>i</mi><mo>∈</mo><msub><mi>I</mi><mi>u</mi></msub></mrow></munder><msub><mi>q</mi><mrow><mi>i</mi><mi>k</mi></mrow></msub><msubsup><mi mathvariant="bold">q</mi><mi>i</mi><mi mathvariant="normal">T</mi></msubsup><msub><mi mathvariant="bold">p</mi><mi>u</mi></msub><mo>−</mo><munder><mo>∑</mo><mrow><mi>i</mi><mo>∈</mo><msub><mi>I</mi><mi>u</mi></msub></mrow></munder><msub><mi>q</mi><mrow><mi>i</mi><mi>k</mi></mrow></msub><msub><mi>r</mi><mrow><mi>u</mi><mi>i</mi></mrow></msub><mo>+</mo><mi>λ</mi><msub><mi>n</mi><msub><mi>p</mi><mi>u</mi></msub></msub><msub><mi>p</mi><mrow><mi>k</mi><mi>u</mi></mrow></msub></mrow></mstyle></mtd></mtr></mtable>\begin<!-- -->{<!-- -->aligned<!-- -->}<!-- --> \frac<!-- -->{<!-- -->1<!-- -->}<!-- -->{<!-- -->2<!-- -->}<!-- --> \frac<!-- -->{<!-- -->\partial L<!-- -->}<!-- -->{<!-- -->\partial p_<!-- -->{<!-- -->uk<!-- -->}<!-- -->}<!-- --> &amp;= \sum_<!-- -->{<!-- -->i \in I_u<!-- -->}<!-- -->(\mathbf<!-- -->{<!-- -->p<!-- -->}<!-- -->_u^\mathrm<!-- -->{<!-- -->T<!-- -->}<!-- -->\mathbf<!-- -->{<!-- -->q<!-- -->}<!-- -->_i - r_<!-- -->{<!-- -->ui<!-- -->}<!-- -->)q_<!-- -->{<!-- -->ik<!-- -->}<!-- --> + \lambda n_<!-- -->{<!-- -->p_u<!-- -->}<!-- --> p_<!-- -->{<!-- -->ku<!-- -->}<!-- --> \\ &amp;= \sum_<!-- -->{<!-- -->i \in I_u<!-- -->}<!-- --> q_<!-- -->{<!-- -->ik<!-- -->}<!-- --> \mathbf<!-- -->{<!-- -->q<!-- -->}<!-- -->_i^\mathrm<!-- -->{<!-- -->T<!-- -->}<!-- -->\mathbf<!-- -->{<!-- -->p<!-- -->}<!-- -->_u - \sum_<!-- -->{<!-- -->i \in I_u<!-- -->}<!-- --> q_<!-- -->{<!-- -->ik<!-- -->}<!-- -->r_<!-- -->{<!-- -->ui<!-- -->}<!-- --> + \lambda n_<!-- -->{<!-- -->p_u<!-- -->}<!-- --> p_<!-- -->{<!-- -->ku<!-- -->}<!-- --> \end<!-- -->{<!-- -->aligned<!-- -->}</math></span><span aria-hidden="true" class="katex-html"><span class="base"><span style="height:5.810317em;vertical-align:-2.6551585000000006em" class="strut"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:3.1551584999999998em" class="vlist"><span style="top:-5.155158499999999em"><span style="height:3.3714399999999998em" class="pstrut"></span><span class="mord"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:1.32144em" class="vlist"><span style="top:-2.314em"><span style="height:3em" class="pstrut"></span><span class="mord"><span class="mord">2</span></span></span><span style="top:-3.23em"><span style="height:3em" class="pstrut"></span><span style="border-bottom-width:0.04em" class="frac-line"></span></span><span style="top:-3.677em"><span style="height:3em" class="pstrut"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.686em" class="vlist"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:1.37144em" class="vlist"><span style="top:-2.314em"><span style="height:3em" class="pstrut"></span><span class="mord"><span style="margin-right:0.05556em" class="mord">∂</span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:0.33610799999999996em" class="vlist"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em"><span style="height:2.7em" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">u</span><span style="margin-right:0.03148em" class="mord mathnormal mtight">k</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.15em" class="vlist"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em"><span style="height:3em" class="pstrut"></span><span style="border-bottom-width:0.04em" class="frac-line"></span></span><span style="top:-3.677em"><span style="height:3em" class="pstrut"></span><span class="mord"><span style="margin-right:0.05556em" class="mord">∂</span><span class="mord mathnormal">L</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.8804400000000001em" class="vlist"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span style="top:-2.410717499999999em"><span style="height:3.3714399999999998em" class="pstrut"></span><span class="mord"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:2.6551585000000006em" class="vlist"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:3.1551584999999998em" class="vlist"><span style="top:-5.155158499999999em"><span style="height:3.3714399999999998em" class="pstrut"></span><span class="mord"><span class="mord"></span><span style="margin-right:0.2777777777777778em" class="mspace"></span><span class="mrel">=</span><span style="margin-right:0.2777777777777778em" class="mspace"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:1.050005em" class="vlist"><span style="top:-1.855664em;margin-left:0em"><span style="height:3.05em" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">∈</span><span class="mord mtight"><span style="margin-right:0.07847em" class="mord mathnormal mtight">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:0.16454285714285719em" class="vlist"><span style="top:-2.357em;margin-left:-0.07847em;margin-right:0.07142857142857144em"><span style="height:2.5em" class="pstrut"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">u</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.143em" class="vlist"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.0500049999999996em"><span style="height:3.05em" class="pstrut"></span><span><span class="mop op-symbol large-op">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:1.394436em" class="vlist"><span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord"><span class="mord mathbf">p</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:0.8913309999999999em" class="vlist"><span style="top:-2.4530000000000003em;margin-right:0.05em"><span style="height:2.7em" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">u</span></span></span><span style="top:-3.113em;margin-right:0.05em"><span style="height:2.7em" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight">T</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.247em" class="vlist"><span></span></span></span></span></span></span><span class="mord"><span class="mord"><span class="mord mathbf">q</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:0.31166399999999994em" class="vlist"><span style="top:-2.5500000000000003em;margin-right:0.05em"><span style="height:2.7em" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.15em" class="vlist"><span></span></span></span></span></span></span><span style="margin-right:0.2222222222222222em" class="mspace"></span><span class="mbin">−</span><span style="margin-right:0.2222222222222222em" class="mspace"></span><span class="mord"><span style="margin-right:0.02778em" class="mord mathnormal">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:0.31166399999999994em" class="vlist"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em"><span style="height:2.7em" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">u</span><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.15em" class="vlist"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mord"><span style="margin-right:0.03588em" class="mord mathnormal">q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:0.33610799999999996em" class="vlist"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em"><span style="height:2.7em" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span style="margin-right:0.03148em" class="mord mathnormal mtight">k</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.15em" class="vlist"><span></span></span></span></span></span></span><span style="margin-right:0.2222222222222222em" class="mspace"></span><span class="mbin">+</span><span style="margin-right:0.2222222222222222em" class="mspace"></span><span class="mord mathnormal">λ</span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:0.15139200000000003em" class="vlist"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em"><span style="height:2.7em" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:0.16454285714285719em" class="vlist"><span style="top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em"><span style="height:2.5em" class="pstrut"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">u</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.143em" class="vlist"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.286108em" class="vlist"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:0.33610799999999996em" class="vlist"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em"><span style="height:2.7em" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span style="margin-right:0.03148em" class="mord mathnormal mtight">k</span><span class="mord mathnormal mtight">u</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.15em" class="vlist"><span></span></span></span></span></span></span></span></span><span style="top:-2.410717499999999em"><span style="height:3.3714399999999998em" class="pstrut"></span><span class="mord"><span class="mord"></span><span style="margin-right:0.2777777777777778em" class="mspace"></span><span class="mrel">=</span><span style="margin-right:0.2777777777777778em" class="mspace"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:1.050005em" class="vlist"><span style="top:-1.855664em;margin-left:0em"><span style="height:3.05em" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">∈</span><span class="mord mtight"><span style="margin-right:0.07847em" class="mord mathnormal mtight">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:0.16454285714285719em" class="vlist"><span style="top:-2.357em;margin-left:-0.07847em;margin-right:0.07142857142857144em"><span style="height:2.5em" class="pstrut"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">u</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.143em" class="vlist"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.0500049999999996em"><span style="height:3.05em" class="pstrut"></span><span><span class="mop op-symbol large-op">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:1.394436em" class="vlist"><span></span></span></span></span></span><span style="margin-right:0.16666666666666666em" class="mspace"></span><span class="mord"><span style="margin-right:0.03588em" class="mord mathnormal">q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:0.33610799999999996em" class="vlist"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em"><span style="height:2.7em" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span style="margin-right:0.03148em" class="mord mathnormal mtight">k</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.15em" class="vlist"><span></span></span></span></span></span></span><span class="mord"><span class="mord"><span class="mord mathbf">q</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:0.8913309999999999em" class="vlist"><span style="top:-2.4530000000000003em;margin-right:0.05em"><span style="height:2.7em" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span><span style="top:-3.113em;margin-right:0.05em"><span style="height:2.7em" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight">T</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.247em" class="vlist"><span></span></span></span></span></span></span><span class="mord"><span class="mord"><span class="mord mathbf">p</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:0.151392em" class="vlist"><span style="top:-2.5500000000000003em;margin-right:0.05em"><span style="height:2.7em" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">u</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.15em" class="vlist"><span></span></span></span></span></span></span><span style="margin-right:0.2222222222222222em" class="mspace"></span><span class="mbin">−</span><span style="margin-right:0.2222222222222222em" class="mspace"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:1.050005em" class="vlist"><span style="top:-1.855664em;margin-left:0em"><span style="height:3.05em" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">∈</span><span class="mord mtight"><span style="margin-right:0.07847em" class="mord mathnormal mtight">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:0.16454285714285719em" class="vlist"><span style="top:-2.357em;margin-left:-0.07847em;margin-right:0.07142857142857144em"><span style="height:2.5em" class="pstrut"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">u</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.143em" class="vlist"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.0500049999999996em"><span style="height:3.05em" class="pstrut"></span><span><span class="mop op-symbol large-op">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:1.394436em" class="vlist"><span></span></span></span></span></span><span style="margin-right:0.16666666666666666em" class="mspace"></span><span class="mord"><span style="margin-right:0.03588em" class="mord mathnormal">q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:0.33610799999999996em" class="vlist"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em"><span style="height:2.7em" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span style="margin-right:0.03148em" class="mord mathnormal mtight">k</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.15em" class="vlist"><span></span></span></span></span></span></span><span class="mord"><span style="margin-right:0.02778em" class="mord mathnormal">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:0.31166399999999994em" class="vlist"><span style="top:-2.5500000000000003em;margin-left:-0.02778em;margin-right:0.05em"><span style="height:2.7em" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">u</span><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.15em" class="vlist"><span></span></span></span></span></span></span><span style="margin-right:0.2222222222222222em" class="mspace"></span><span class="mbin">+</span><span style="margin-right:0.2222222222222222em" class="mspace"></span><span class="mord mathnormal">λ</span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:0.15139200000000003em" class="vlist"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em"><span style="height:2.7em" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:0.16454285714285719em" class="vlist"><span style="top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em"><span style="height:2.5em" class="pstrut"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">u</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.143em" class="vlist"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.286108em" class="vlist"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:0.33610799999999996em" class="vlist"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em"><span style="height:2.7em" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span style="margin-right:0.03148em" class="mord mathnormal mtight">k</span><span class="mord mathnormal mtight">u</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.15em" class="vlist"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:2.6551585000000006em" class="vlist"><span></span></span></span></span></span></span></span></span></span></span></span></div><p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow><mn>1</mn></mrow>1</math></span><span aria-hidden="true" class="katex-html"><span class="base"><span style="height:0.64444em;vertical-align:0em" class="strut"></span><span class="mord">1</span></span></span></span></span> から <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow><mi>K</mi></mrow>K</math></span><span aria-hidden="true" class="katex-html"><span class="base"><span style="height:0.68333em;vertical-align:0em" class="strut"></span><span style="margin-right:0.07153em" class="mord mathnormal">K</span></span></span></span></span> までの潜在因子 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow><mi>k</mi></mrow>k</math></span><span aria-hidden="true" class="katex-html"><span class="base"><span style="height:0.69444em;vertical-align:0em" class="strut"></span><span style="margin-right:0.03148em" class="mord mathnormal">k</span></span></span></span></span> を並べてベクトルとしてまとめると：</p><div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><mtable rowspacing="0.24999999999999992em"><mtr><mtd><mstyle displaystyle="true" scriptlevel="0"><mrow><mfrac><mn>1</mn><mn>2</mn></mfrac><mfrac><mrow><mi mathvariant="normal">∂</mi><mi>L</mi></mrow><mrow><mi mathvariant="normal">∂</mi><msub><mi mathvariant="bold">p</mi><mi>u</mi></msub></mrow></mfrac></mrow></mstyle></mtd><mtd><mstyle displaystyle="true" scriptlevel="0"><mrow><mrow></mrow><mo>=</mo><msub><mi>Q</mi><msub><mi>I</mi><mi>u</mi></msub></msub><msubsup><mi>Q</mi><msub><mi>I</mi><mi>u</mi></msub><mi mathvariant="normal">T</mi></msubsup><msub><mi mathvariant="bold">p</mi><mi>u</mi></msub><mo>−</mo><msub><mi>Q</mi><msub><mi>I</mi><mi>u</mi></msub></msub><msup><mi>R</mi><mi mathvariant="normal">T</mi></msup><mo stretchy="false">(</mo><mi>u</mi><mo separator="true">,</mo><msub><mi>I</mi><mi>n</mi></msub><mo stretchy="false">)</mo><mo>+</mo><mi>λ</mi><msub><mi>n</mi><msub><mi>p</mi><mi>u</mi></msub></msub><msub><mi mathvariant="bold">p</mi><mi>u</mi></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle displaystyle="true" scriptlevel="0"><mrow></mrow></mstyle></mtd><mtd><mstyle displaystyle="true" scriptlevel="0"><mrow><mrow></mrow><mo>=</mo><mo stretchy="false">(</mo><msub><mi>Q</mi><msub><mi>I</mi><mi>u</mi></msub></msub><msubsup><mi>Q</mi><msub><mi>I</mi><mi>u</mi></msub><mi mathvariant="normal">T</mi></msubsup><mo>+</mo><mi>λ</mi><msub><mi>n</mi><mi>p</mi></msub><mi>E</mi><mo stretchy="false">)</mo><msub><mi mathvariant="bold">p</mi><mi>u</mi></msub><mo>−</mo><msub><mi>Q</mi><msub><mi>I</mi><mi>u</mi></msub></msub><msup><mi>R</mi><mi mathvariant="normal">T</mi></msup><mo stretchy="false">(</mo><mi>u</mi><mo separator="true">,</mo><msub><mi>I</mi><mi>n</mi></msub><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr></mtable>\begin<!-- -->{<!-- -->aligned<!-- -->}<!-- --> \frac<!-- -->{<!-- -->1<!-- -->}<!-- -->{<!-- -->2<!-- -->}<!-- --> \frac<!-- -->{<!-- -->\partial L<!-- -->}<!-- -->{<!-- -->\partial \mathbf<!-- -->{<!-- -->p<!-- -->}<!-- -->_u<!-- -->}<!-- --> &amp;= Q_<!-- -->{<!-- -->I_u<!-- -->}<!-- --> Q_<!-- -->{<!-- -->I_u<!-- -->}<!-- -->^\mathrm<!-- -->{<!-- -->T<!-- -->}<!-- --> \mathbf<!-- -->{<!-- -->p<!-- -->}<!-- -->_u - Q_<!-- -->{<!-- -->I_u<!-- -->}<!-- --> R^\mathrm<!-- -->{<!-- -->T<!-- -->}<!-- --> (u, I_n) + \lambda n_<!-- -->{<!-- -->p_u<!-- -->}<!-- --> \mathbf<!-- -->{<!-- -->p<!-- -->}<!-- -->_u \\ &amp;= (Q_<!-- -->{<!-- -->I_u<!-- -->}<!-- --> Q_<!-- -->{<!-- -->I_u<!-- -->}<!-- -->^\mathrm<!-- -->{<!-- -->T<!-- -->}<!-- --> + \lambda n_p E) \mathbf<!-- -->{<!-- -->p<!-- -->}<!-- -->_u - Q_<!-- -->{<!-- -->I_u<!-- -->}<!-- --> R^\mathrm<!-- -->{<!-- -->T<!-- -->}<!-- --> (u, I_n) \end<!-- -->{<!-- -->aligned<!-- -->}</math></span><span aria-hidden="true" class="katex-html"><span class="base"><span style="height:4.103211em;vertical-align:-1.8016055em" class="strut"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:2.3016055em" class="vlist"><span style="top:-4.3016055em"><span style="height:3.3714399999999998em" class="pstrut"></span><span class="mord"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:1.32144em" class="vlist"><span style="top:-2.314em"><span style="height:3em" class="pstrut"></span><span class="mord"><span class="mord">2</span></span></span><span style="top:-3.23em"><span style="height:3em" class="pstrut"></span><span style="border-bottom-width:0.04em" class="frac-line"></span></span><span style="top:-3.677em"><span style="height:3em" class="pstrut"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.686em" class="vlist"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:1.37144em" class="vlist"><span style="top:-2.314em"><span style="height:3em" class="pstrut"></span><span class="mord"><span style="margin-right:0.05556em" class="mord">∂</span><span class="mord"><span class="mord"><span class="mord mathbf">p</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:0.151392em" class="vlist"><span style="top:-2.5500000000000003em;margin-right:0.05em"><span style="height:2.7em" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">u</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.15em" class="vlist"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em"><span style="height:3em" class="pstrut"></span><span style="border-bottom-width:0.04em" class="frac-line"></span></span><span style="top:-3.677em"><span style="height:3em" class="pstrut"></span><span class="mord"><span style="margin-right:0.05556em" class="mord">∂</span><span class="mord mathnormal">L</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.8804400000000001em" class="vlist"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span style="top:-2.2298345em"><span style="height:3.3714399999999998em" class="pstrut"></span><span class="mord"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:1.8016055em" class="vlist"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:2.3016055em" class="vlist"><span style="top:-4.3016055em"><span style="height:3.3714399999999998em" class="pstrut"></span><span class="mord"><span class="mord"></span><span style="margin-right:0.2777777777777778em" class="mspace"></span><span class="mrel">=</span><span style="margin-right:0.2777777777777778em" class="mspace"></span><span class="mord"><span class="mord mathnormal">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:0.32833099999999993em" class="vlist"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em"><span style="height:2.7em" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span style="margin-right:0.07847em" class="mord mathnormal mtight">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:0.16454285714285719em" class="vlist"><span style="top:-2.357em;margin-left:-0.07847em;margin-right:0.07142857142857144em"><span style="height:2.5em" class="pstrut"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">u</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.143em" class="vlist"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.2501em" class="vlist"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:0.891331em" class="vlist"><span style="top:-2.453em;margin-left:0em;margin-right:0.05em"><span style="height:2.7em" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span style="margin-right:0.07847em" class="mord mathnormal mtight">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:0.16454285714285719em" class="vlist"><span style="top:-2.357em;margin-left:-0.07847em;margin-right:0.07142857142857144em"><span style="height:2.5em" class="pstrut"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">u</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.143em" class="vlist"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.1130000000000004em;margin-right:0.05em"><span style="height:2.7em" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight">T</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.34709999999999996em" class="vlist"><span></span></span></span></span></span></span><span class="mord"><span class="mord"><span class="mord mathbf">p</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:0.151392em" class="vlist"><span style="top:-2.5500000000000003em;margin-right:0.05em"><span style="height:2.7em" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">u</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.15em" class="vlist"><span></span></span></span></span></span></span><span style="margin-right:0.2222222222222222em" class="mspace"></span><span class="mbin">−</span><span style="margin-right:0.2222222222222222em" class="mspace"></span><span class="mord"><span class="mord mathnormal">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:0.32833099999999993em" class="vlist"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em"><span style="height:2.7em" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span style="margin-right:0.07847em" class="mord mathnormal mtight">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:0.16454285714285719em" class="vlist"><span style="top:-2.357em;margin-left:-0.07847em;margin-right:0.07142857142857144em"><span style="height:2.5em" class="pstrut"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">u</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.143em" class="vlist"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.2501em" class="vlist"><span></span></span></span></span></span></span><span class="mord"><span style="margin-right:0.00773em" class="mord mathnormal">R</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span style="height:0.8913309999999999em" class="vlist"><span style="top:-3.113em;margin-right:0.05em"><span style="height:2.7em" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight">T</span></span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">u</span><span class="mpunct">,</span><span style="margin-right:0.16666666666666666em" class="mspace"></span><span class="mord"><span style="margin-right:0.07847em" class="mord mathnormal">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:0.151392em" class="vlist"><span style="top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em"><span style="height:2.7em" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.15em" class="vlist"><span></span></span></span></span></span></span><span class="mclose">)</span><span style="margin-right:0.2222222222222222em" class="mspace"></span><span class="mbin">+</span><span style="margin-right:0.2222222222222222em" class="mspace"></span><span class="mord mathnormal">λ</span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:0.15139200000000003em" class="vlist"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em"><span style="height:2.7em" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:0.16454285714285719em" class="vlist"><span style="top:-2.357em;margin-left:0em;margin-right:0.07142857142857144em"><span style="height:2.5em" class="pstrut"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">u</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.143em" class="vlist"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.286108em" class="vlist"><span></span></span></span></span></span></span><span class="mord"><span class="mord"><span class="mord mathbf">p</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:0.151392em" class="vlist"><span style="top:-2.5500000000000003em;margin-right:0.05em"><span style="height:2.7em" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">u</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.15em" class="vlist"><span></span></span></span></span></span></span></span></span><span style="top:-2.2298345em"><span style="height:3.3714399999999998em" class="pstrut"></span><span class="mord"><span class="mord"></span><span style="margin-right:0.2777777777777778em" class="mspace"></span><span class="mrel">=</span><span style="margin-right:0.2777777777777778em" class="mspace"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:0.32833099999999993em" class="vlist"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em"><span style="height:2.7em" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span style="margin-right:0.07847em" class="mord mathnormal mtight">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:0.16454285714285719em" class="vlist"><span style="top:-2.357em;margin-left:-0.07847em;margin-right:0.07142857142857144em"><span style="height:2.5em" class="pstrut"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">u</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.143em" class="vlist"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.2501em" class="vlist"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:0.891331em" class="vlist"><span style="top:-2.453em;margin-left:0em;margin-right:0.05em"><span style="height:2.7em" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span style="margin-right:0.07847em" class="mord mathnormal mtight">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:0.16454285714285719em" class="vlist"><span style="top:-2.357em;margin-left:-0.07847em;margin-right:0.07142857142857144em"><span style="height:2.5em" class="pstrut"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">u</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.143em" class="vlist"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.1130000000000004em;margin-right:0.05em"><span style="height:2.7em" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight">T</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.34709999999999996em" class="vlist"><span></span></span></span></span></span></span><span style="margin-right:0.2222222222222222em" class="mspace"></span><span class="mbin">+</span><span style="margin-right:0.2222222222222222em" class="mspace"></span><span class="mord mathnormal">λ</span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:0.15139200000000003em" class="vlist"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em"><span style="height:2.7em" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">p</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.286108em" class="vlist"><span></span></span></span></span></span></span><span style="margin-right:0.05764em" class="mord mathnormal">E</span><span class="mclose">)</span><span class="mord"><span class="mord"><span class="mord mathbf">p</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:0.151392em" class="vlist"><span style="top:-2.5500000000000003em;margin-right:0.05em"><span style="height:2.7em" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">u</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.15em" class="vlist"><span></span></span></span></span></span></span><span style="margin-right:0.2222222222222222em" class="mspace"></span><span class="mbin">−</span><span style="margin-right:0.2222222222222222em" class="mspace"></span><span class="mord"><span class="mord mathnormal">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:0.32833099999999993em" class="vlist"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em"><span style="height:2.7em" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span style="margin-right:0.07847em" class="mord mathnormal mtight">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:0.16454285714285719em" class="vlist"><span style="top:-2.357em;margin-left:-0.07847em;margin-right:0.07142857142857144em"><span style="height:2.5em" class="pstrut"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">u</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.143em" class="vlist"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.2501em" class="vlist"><span></span></span></span></span></span></span><span class="mord"><span style="margin-right:0.00773em" class="mord mathnormal">R</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span style="height:0.8913309999999999em" class="vlist"><span style="top:-3.113em;margin-right:0.05em"><span style="height:2.7em" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight">T</span></span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">u</span><span class="mpunct">,</span><span style="margin-right:0.16666666666666666em" class="mspace"></span><span class="mord"><span style="margin-right:0.07847em" class="mord mathnormal">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:0.151392em" class="vlist"><span style="top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em"><span style="height:2.7em" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.15em" class="vlist"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:1.8016055em" class="vlist"><span></span></span></span></span></span></span></span></span></span></span></span></div><p>ここで <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow><msub><mi>Q</mi><msub><mi>I</mi><mi>u</mi></msub></msub></mrow>Q_<!-- -->{<!-- -->I_u<!-- -->}</math></span><span aria-hidden="true" class="katex-html"><span class="base"><span style="height:0.93343em;vertical-align:-0.2501em" class="strut"></span><span class="mord"><span class="mord mathnormal">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:0.32833099999999993em" class="vlist"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em"><span style="height:2.7em" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span style="margin-right:0.07847em" class="mord mathnormal mtight">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:0.16454285714285719em" class="vlist"><span style="top:-2.357em;margin-left:-0.07847em;margin-right:0.07142857142857144em"><span style="height:2.5em" class="pstrut"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">u</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.143em" class="vlist"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.2501em" class="vlist"><span></span></span></span></span></span></span></span></span></span></span> は <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow><mi>Q</mi></mrow>Q</math></span><span aria-hidden="true" class="katex-html"><span class="base"><span style="height:0.8777699999999999em;vertical-align:-0.19444em" class="strut"></span><span class="mord mathnormal">Q</span></span></span></span></span> の中からユーザ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow><mi>u</mi></mrow>u</math></span><span aria-hidden="true" class="katex-html"><span class="base"><span style="height:0.43056em;vertical-align:0em" class="strut"></span><span class="mord mathnormal">u</span></span></span></span></span> が評価した商品 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow><msub><mi>I</mi><mi>u</mi></msub></mrow>I_u</math></span><span aria-hidden="true" class="katex-html"><span class="base"><span style="height:0.83333em;vertical-align:-0.15em" class="strut"></span><span class="mord"><span style="margin-right:0.07847em" class="mord mathnormal">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:0.151392em" class="vlist"><span style="top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em"><span style="height:2.7em" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">u</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.15em" class="vlist"><span></span></span></span></span></span></span></span></span></span></span> に関する行だけを抜き出したもので、<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow><msup><mi>R</mi><mi mathvariant="normal">T</mi></msup><mo stretchy="false">(</mo><mi>u</mi><mo separator="true">,</mo><msub><mi>I</mi><mi>n</mi></msub><mo stretchy="false">)</mo></mrow>R^\mathrm<!-- -->{<!-- -->T<!-- -->}<!-- --> (u, I_n)</math></span><span aria-hidden="true" class="katex-html"><span class="base"><span style="height:1.0913309999999998em;vertical-align:-0.25em" class="strut"></span><span class="mord"><span style="margin-right:0.00773em" class="mord mathnormal">R</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span style="height:0.8413309999999999em" class="vlist"><span style="top:-3.063em;margin-right:0.05em"><span style="height:2.7em" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight">T</span></span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">u</span><span class="mpunct">,</span><span style="margin-right:0.16666666666666666em" class="mspace"></span><span class="mord"><span style="margin-right:0.07847em" class="mord mathnormal">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:0.151392em" class="vlist"><span style="top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em"><span style="height:2.7em" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.15em" class="vlist"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span> は <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow><mi>R</mi></mrow>R</math></span><span aria-hidden="true" class="katex-html"><span class="base"><span style="height:0.68333em;vertical-align:0em" class="strut"></span><span style="margin-right:0.00773em" class="mord mathnormal">R</span></span></span></span></span> からユーザ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow><mi>u</mi></mrow>u</math></span><span aria-hidden="true" class="katex-html"><span class="base"><span style="height:0.43056em;vertical-align:0em" class="strut"></span><span class="mord mathnormal">u</span></span></span></span></span> の行の中から商品 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow><msub><mi>I</mi><mi>u</mi></msub></mrow>I_u</math></span><span aria-hidden="true" class="katex-html"><span class="base"><span style="height:0.83333em;vertical-align:-0.15em" class="strut"></span><span class="mord"><span style="margin-right:0.07847em" class="mord mathnormal">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:0.151392em" class="vlist"><span style="top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em"><span style="height:2.7em" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">u</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.15em" class="vlist"><span></span></span></span></span></span></span></span></span></span></span> に関するものだけを抜き出したベクトルを表します。</p><div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><mtable rowspacing="0.24999999999999992em"><mtr><mtd><mstyle displaystyle="true" scriptlevel="0"><mfrac><mrow><mi mathvariant="normal">∂</mi><mi>L</mi></mrow><mrow><mi mathvariant="normal">∂</mi><msub><mi mathvariant="bold">p</mi><mi>u</mi></msub></mrow></mfrac></mstyle></mtd><mtd><mstyle displaystyle="true" scriptlevel="0"><mrow><mrow></mrow><mo>=</mo><mn>0</mn></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle displaystyle="true" scriptlevel="0"><mrow><mo>⇒</mo><mtext>  </mtext><msub><mi mathvariant="bold">p</mi><mi>u</mi></msub></mrow></mstyle></mtd><mtd><mstyle displaystyle="true" scriptlevel="0"><mrow><mrow></mrow><mo>=</mo><mo stretchy="false">(</mo><msub><mi>Q</mi><msub><mi>I</mi><mi>u</mi></msub></msub><msubsup><mi>Q</mi><msub><mi>I</mi><mi>u</mi></msub><mi mathvariant="normal">T</mi></msubsup><mo>+</mo><mi>λ</mi><msub><mi>n</mi><mi>p</mi></msub><mi>E</mi><msup><mo stretchy="false">)</mo><mrow><mo>−</mo><mn>1</mn></mrow></msup><msub><mi>Q</mi><msub><mi>I</mi><mi>u</mi></msub></msub><msup><mi>R</mi><mi mathvariant="normal">T</mi></msup><mo stretchy="false">(</mo><mi>u</mi><mo separator="true">,</mo><msub><mi>I</mi><mi>n</mi></msub><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle displaystyle="true" scriptlevel="0"><mrow><mo>⇒</mo><mtext>  </mtext><msub><mi mathvariant="bold">p</mi><mi>u</mi></msub></mrow></mstyle></mtd><mtd><mstyle displaystyle="true" scriptlevel="0"><mrow><mrow></mrow><mo>=</mo><msubsup><mi>A</mi><mi>u</mi><mrow><mo>−</mo><mn>1</mn></mrow></msubsup><msub><mi>V</mi><mi>u</mi></msub></mrow></mstyle></mtd></mtr></mtable>\begin<!-- -->{<!-- -->aligned<!-- -->}<!-- --> \frac<!-- -->{<!-- -->\partial L<!-- -->}<!-- -->{<!-- -->\partial \mathbf<!-- -->{<!-- -->p<!-- -->}<!-- -->_u<!-- -->}<!-- --> &amp;= 0 \\ \Rightarrow \; \mathbf<!-- -->{<!-- -->p<!-- -->}<!-- -->_u &amp;= (Q_<!-- -->{<!-- -->I_u<!-- -->}<!-- --> Q_<!-- -->{<!-- -->I_u<!-- -->}<!-- -->^\mathrm<!-- -->{<!-- -->T<!-- -->}<!-- --> + \lambda n_p E)^<!-- -->{<!-- -->-1<!-- -->}<!-- --> Q_<!-- -->{<!-- -->I_u<!-- -->}<!-- --> R^\mathrm<!-- -->{<!-- -->T<!-- -->}<!-- --> (u, I_n) \\ \Rightarrow \; \mathbf<!-- -->{<!-- -->p<!-- -->}<!-- -->_u &amp;= A_u^<!-- -->{<!-- -->-1<!-- -->}<!-- -->V_u \end<!-- -->{<!-- -->aligned<!-- -->}</math></span><span aria-hidden="true" class="katex-html"><span class="base"><span style="height:5.627319em;vertical-align:-2.5636594999999995em" class="strut"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:3.0636595em" class="vlist"><span style="top:-5.0636595em"><span style="height:3.3714399999999998em" class="pstrut"></span><span class="mord"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:1.37144em" class="vlist"><span style="top:-2.314em"><span style="height:3em" class="pstrut"></span><span class="mord"><span style="margin-right:0.05556em" class="mord">∂</span><span class="mord"><span class="mord"><span class="mord mathbf">p</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:0.151392em" class="vlist"><span style="top:-2.5500000000000003em;margin-right:0.05em"><span style="height:2.7em" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">u</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.15em" class="vlist"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em"><span style="height:3em" class="pstrut"></span><span style="border-bottom-width:0.04em" class="frac-line"></span></span><span style="top:-3.677em"><span style="height:3em" class="pstrut"></span><span class="mord"><span style="margin-right:0.05556em" class="mord">∂</span><span class="mord mathnormal">L</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.8804400000000001em" class="vlist"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span style="top:-2.9918885em"><span style="height:3.3714399999999998em" class="pstrut"></span><span class="mord"><span class="mrel">⇒</span><span style="margin-right:0.2777777777777778em" class="mspace"></span><span style="margin-right:0.2777777777777778em" class="mspace"></span><span class="mord"><span class="mord"><span class="mord mathbf">p</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:0.151392em" class="vlist"><span style="top:-2.5500000000000003em;margin-right:0.05em"><span style="height:2.7em" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">u</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.15em" class="vlist"><span></span></span></span></span></span></span></span></span><span style="top:-1.4677805000000004em"><span style="height:3.3714399999999998em" class="pstrut"></span><span class="mord"><span class="mrel">⇒</span><span style="margin-right:0.2777777777777778em" class="mspace"></span><span style="margin-right:0.2777777777777778em" class="mspace"></span><span class="mord"><span class="mord"><span class="mord mathbf">p</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:0.151392em" class="vlist"><span style="top:-2.5500000000000003em;margin-right:0.05em"><span style="height:2.7em" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">u</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.15em" class="vlist"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:2.5636594999999995em" class="vlist"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:3.0636595em" class="vlist"><span style="top:-5.0636595em"><span style="height:3.3714399999999998em" class="pstrut"></span><span class="mord"><span class="mord"></span><span style="margin-right:0.2777777777777778em" class="mspace"></span><span class="mrel">=</span><span style="margin-right:0.2777777777777778em" class="mspace"></span><span class="mord">0</span></span></span><span style="top:-2.9918885em"><span style="height:3.3714399999999998em" class="pstrut"></span><span class="mord"><span class="mord"></span><span style="margin-right:0.2777777777777778em" class="mspace"></span><span class="mrel">=</span><span style="margin-right:0.2777777777777778em" class="mspace"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:0.32833099999999993em" class="vlist"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em"><span style="height:2.7em" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span style="margin-right:0.07847em" class="mord mathnormal mtight">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:0.16454285714285719em" class="vlist"><span style="top:-2.357em;margin-left:-0.07847em;margin-right:0.07142857142857144em"><span style="height:2.5em" class="pstrut"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">u</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.143em" class="vlist"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.2501em" class="vlist"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:0.891331em" class="vlist"><span style="top:-2.453em;margin-left:0em;margin-right:0.05em"><span style="height:2.7em" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span style="margin-right:0.07847em" class="mord mathnormal mtight">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:0.16454285714285719em" class="vlist"><span style="top:-2.357em;margin-left:-0.07847em;margin-right:0.07142857142857144em"><span style="height:2.5em" class="pstrut"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">u</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.143em" class="vlist"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.1130000000000004em;margin-right:0.05em"><span style="height:2.7em" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight">T</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.34709999999999996em" class="vlist"><span></span></span></span></span></span></span><span style="margin-right:0.2222222222222222em" class="mspace"></span><span class="mbin">+</span><span style="margin-right:0.2222222222222222em" class="mspace"></span><span class="mord mathnormal">λ</span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:0.15139200000000003em" class="vlist"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em"><span style="height:2.7em" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">p</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.286108em" class="vlist"><span></span></span></span></span></span></span><span style="margin-right:0.05764em" class="mord mathnormal">E</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span style="height:0.864108em" class="vlist"><span style="top:-3.113em;margin-right:0.05em"><span style="height:2.7em" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:0.32833099999999993em" class="vlist"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em"><span style="height:2.7em" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span style="margin-right:0.07847em" class="mord mathnormal mtight">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:0.16454285714285719em" class="vlist"><span style="top:-2.357em;margin-left:-0.07847em;margin-right:0.07142857142857144em"><span style="height:2.5em" class="pstrut"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">u</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.143em" class="vlist"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.2501em" class="vlist"><span></span></span></span></span></span></span><span class="mord"><span style="margin-right:0.00773em" class="mord mathnormal">R</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span style="height:0.8913309999999999em" class="vlist"><span style="top:-3.113em;margin-right:0.05em"><span style="height:2.7em" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight">T</span></span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">u</span><span class="mpunct">,</span><span style="margin-right:0.16666666666666666em" class="mspace"></span><span class="mord"><span style="margin-right:0.07847em" class="mord mathnormal">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:0.151392em" class="vlist"><span style="top:-2.5500000000000003em;margin-left:-0.07847em;margin-right:0.05em"><span style="height:2.7em" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.15em" class="vlist"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span><span style="top:-1.4677805000000004em"><span style="height:3.3714399999999998em" class="pstrut"></span><span class="mord"><span class="mord"></span><span style="margin-right:0.2777777777777778em" class="mspace"></span><span class="mrel">=</span><span style="margin-right:0.2777777777777778em" class="mspace"></span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:0.8641079999999999em" class="vlist"><span style="top:-2.4530000000000003em;margin-left:0em;margin-right:0.05em"><span style="height:2.7em" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">u</span></span></span><span style="top:-3.113em;margin-right:0.05em"><span style="height:2.7em" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.247em" class="vlist"><span></span></span></span></span></span></span><span class="mord"><span style="margin-right:0.22222em" class="mord mathnormal">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:0.151392em" class="vlist"><span style="top:-2.5500000000000003em;margin-left:-0.22222em;margin-right:0.05em"><span style="height:2.7em" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">u</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.15em" class="vlist"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:2.5636594999999995em" class="vlist"><span></span></span></span></span></span></span></span></span></span></span></span></div><p>このようにユーザ因子行列 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow><mi>P</mi></mrow>P</math></span><span aria-hidden="true" class="katex-html"><span class="base"><span style="height:0.68333em;vertical-align:0em" class="strut"></span><span style="margin-right:0.13889em" class="mord mathnormal">P</span></span></span></span></span> は <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow><mi>Q</mi></mrow>Q</math></span><span aria-hidden="true" class="katex-html"><span class="base"><span style="height:0.8777699999999999em;vertical-align:-0.19444em" class="strut"></span><span class="mord mathnormal">Q</span></span></span></span></span> と <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow><mi>R</mi></mrow>R</math></span><span aria-hidden="true" class="katex-html"><span class="base"><span style="height:0.68333em;vertical-align:0em" class="strut"></span><span style="margin-right:0.00773em" class="mord mathnormal">R</span></span></span></span></span> だけに依存して更新できることが分かります。 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow><msub><mi>q</mi><mrow><mi>i</mi><mi>k</mi></mrow></msub></mrow>q_<!-- -->{<!-- -->ik<!-- -->}</math></span><span aria-hidden="true" class="katex-html"><span class="base"><span style="height:0.625em;vertical-align:-0.19444em" class="strut"></span><span class="mord"><span style="margin-right:0.03588em" class="mord mathnormal">q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:0.33610799999999996em" class="vlist"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em"><span style="height:2.7em" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span style="margin-right:0.03148em" class="mord mathnormal mtight">k</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.15em" class="vlist"><span></span></span></span></span></span></span></span></span></span></span> で偏微分して整理していけば同様に商品因子行列 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow><mi>Q</mi></mrow>Q</math></span><span aria-hidden="true" class="katex-html"><span class="base"><span style="height:0.8777699999999999em;vertical-align:-0.19444em" class="strut"></span><span class="mord mathnormal">Q</span></span></span></span></span> が <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow><mi>P</mi></mrow>P</math></span><span aria-hidden="true" class="katex-html"><span class="base"><span style="height:0.68333em;vertical-align:0em" class="strut"></span><span style="margin-right:0.13889em" class="mord mathnormal">P</span></span></span></span></span> と <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow><mi>R</mi></mrow>R</math></span><span aria-hidden="true" class="katex-html"><span class="base"><span style="height:0.68333em;vertical-align:0em" class="strut"></span><span style="margin-right:0.00773em" class="mord mathnormal">R</span></span></span></span></span> だけを使って更新できることが示されます。</p><p>ALS ではこの式を用いて <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow><mi>P</mi></mrow>P</math></span><span aria-hidden="true" class="katex-html"><span class="base"><span style="height:0.68333em;vertical-align:0em" class="strut"></span><span style="margin-right:0.13889em" class="mord mathnormal">P</span></span></span></span></span> と <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow><mi>Q</mi></mrow>Q</math></span><span aria-hidden="true" class="katex-html"><span class="base"><span style="height:0.8777699999999999em;vertical-align:-0.19444em" class="strut"></span><span class="mord mathnormal">Q</span></span></span></span></span> を交互に更新し、損失関数が変化しなくなるまで反復します。問題は <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow><msub><mi>A</mi><mi>u</mi></msub></mrow>A_u</math></span><span aria-hidden="true" class="katex-html"><span class="base"><span style="height:0.83333em;vertical-align:-0.15em" class="strut"></span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:0.151392em" class="vlist"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em"><span style="height:2.7em" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">u</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.15em" class="vlist"><span></span></span></span></span></span></span></span></span></span></span> の逆行列が存在するのか定かでないことですが、この点についてもとの論文にも特に言及がなかったのでよくわかっていません。</p><h3>分散処理</h3><p>巨大なデータセットに対して ALS を実行する際にもっとも影響が大きな影響をもつのが <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow><mi>R</mi></mrow>R</math></span><span aria-hidden="true" class="katex-html"><span class="base"><span style="height:0.68333em;vertical-align:0em" class="strut"></span><span style="margin-right:0.00773em" class="mord mathnormal">R</span></span></span></span></span> です。 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow><mi>R</mi></mrow>R</math></span><span aria-hidden="true" class="katex-html"><span class="base"><span style="height:0.68333em;vertical-align:0em" class="strut"></span><span style="margin-right:0.00773em" class="mord mathnormal">R</span></span></span></span></span> は <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow><mi mathvariant="normal">∣</mi><mi>U</mi><mi mathvariant="normal">∣</mi><mo>×</mo><mi mathvariant="normal">∣</mi><mi>D</mi><mi mathvariant="normal">∣</mi></mrow>|U| \times |D|</math></span><span aria-hidden="true" class="katex-html"><span class="base"><span style="height:1em;vertical-align:-0.25em" class="strut"></span><span class="mord">∣</span><span style="margin-right:0.10903em" class="mord mathnormal">U</span><span class="mord">∣</span><span style="margin-right:0.2222222222222222em" class="mspace"></span><span class="mbin">×</span><span style="margin-right:0.2222222222222222em" class="mspace"></span></span><span class="base"><span style="height:1em;vertical-align:-0.25em" class="strut"></span><span class="mord">∣</span><span style="margin-right:0.02778em" class="mord mathnormal">D</span><span class="mord">∣</span></span></span></span></span> 行列であり、ユーザ数と商品数が増えると猛烈な勢いで大きくなっていきますが、一般に一人のユーザが評価するのは商品のごく一部でしかないので、極めて疎に行列です。データセットが巨大になったとき <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow><mi>R</mi></mrow>R</math></span><span aria-hidden="true" class="katex-html"><span class="base"><span style="height:0.68333em;vertical-align:0em" class="strut"></span><span style="margin-right:0.00773em" class="mord mathnormal">R</span></span></span></span></span> をそのままメモリにもつことは困難です。</p><p>前述のように ALS では <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow><mi>P</mi></mrow>P</math></span><span aria-hidden="true" class="katex-html"><span class="base"><span style="height:0.68333em;vertical-align:0em" class="strut"></span><span style="margin-right:0.13889em" class="mord mathnormal">P</span></span></span></span></span> は <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow><mi>Q</mi></mrow>Q</math></span><span aria-hidden="true" class="katex-html"><span class="base"><span style="height:0.8777699999999999em;vertical-align:-0.19444em" class="strut"></span><span class="mord mathnormal">Q</span></span></span></span></span> と <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow><mi>R</mi></mrow>R</math></span><span aria-hidden="true" class="katex-html"><span class="base"><span style="height:0.68333em;vertical-align:0em" class="strut"></span><span style="margin-right:0.00773em" class="mord mathnormal">R</span></span></span></span></span> だけを使って更新します。そのため、 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow><mi>P</mi></mrow>P</math></span><span aria-hidden="true" class="katex-html"><span class="base"><span style="height:0.68333em;vertical-align:0em" class="strut"></span><span style="margin-right:0.13889em" class="mord mathnormal">P</span></span></span></span></span> と <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow><mi>Q</mi></mrow>Q</math></span><span aria-hidden="true" class="katex-html"><span class="base"><span style="height:0.8777699999999999em;vertical-align:-0.19444em" class="strut"></span><span class="mord mathnormal">Q</span></span></span></span></span> の計算は各反復において互いに独立して並列に行うことができます。</p><p>さらに <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow><mi>R</mi></mrow>R</math></span><span aria-hidden="true" class="katex-html"><span class="base"><span style="height:0.68333em;vertical-align:0em" class="strut"></span><span style="margin-right:0.00773em" class="mord mathnormal">R</span></span></span></span></span> は更新しているユーザが評価した商品の評価値だけを取り出せばいいので、 <a href="https://en.wikipedia.org/wiki/Sparse_matrix#Compressed_sparse_column_(CSC_or_CCS)">CSC</a> のように列方向に圧縮された形式で保持することで、データサイズを小さくしつつ効率的に計算をすることが可能です。</p><p>ただこの記事では単純に大変であることに加えて、単一の Jupyter Notebook 上で実装する方法がよく分からないので、分散処理は実装しません。</p></div><div class="nb-cell nb-markdown-cell"><h2>ALS を実装する</h2><p>ALS を実装する際にもっとも紛らわしいのが <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow><msub><mi>Q</mi><msub><mi>I</mi><mi>u</mi></msub></msub></mrow>Q_<!-- -->{<!-- -->I_u<!-- -->}</math></span><span aria-hidden="true" class="katex-html"><span class="base"><span style="height:0.93343em;vertical-align:-0.2501em" class="strut"></span><span class="mord"><span class="mord mathnormal">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:0.32833099999999993em" class="vlist"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em"><span style="height:2.7em" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span style="margin-right:0.07847em" class="mord mathnormal mtight">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:0.16454285714285719em" class="vlist"><span style="top:-2.357em;margin-left:-0.07847em;margin-right:0.07142857142857144em"><span style="height:2.5em" class="pstrut"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">u</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.143em" class="vlist"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.2501em" class="vlist"><span></span></span></span></span></span></span></span></span></span></span> を求める部分でしょう。</p><p>仮にレーティング行列として次の <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow><mi>R</mi></mrow>R</math></span><span aria-hidden="true" class="katex-html"><span class="base"><span style="height:0.68333em;vertical-align:0em" class="strut"></span><span style="margin-right:0.00773em" class="mord mathnormal">R</span></span></span></span></span> が与えられたとします。</p></div><div class="nb-cell nb-code-cell"><div class="nb-input" data-prompt-number="1"><pre class="language-julia"><code class="language-julia" data-language="julia">R <span class="token operator">=</span>  <span class="token punctuation">[</span>
<!-- -->    <span class="token number">0</span>   <span class="token number">4.5</span> <span class="token number">2.0</span> <span class="token number">0</span><span class="token punctuation">;</span>
<!-- -->    <span class="token number">4.0</span> <span class="token number">0</span>   <span class="token number">3.5</span> <span class="token number">0</span><span class="token punctuation">;</span>
<!-- -->    <span class="token number">0</span>   <span class="token number">5.0</span> <span class="token number">0</span>   <span class="token number">2.0</span><span class="token punctuation">;</span>
<!-- -->    <span class="token number">0</span>   <span class="token number">3.5</span> <span class="token number">4.0</span> <span class="token number">1.0</span>
<span class="token punctuation">]</span></code></pre></div><div class="nb-output" data-prompt-number="1"><pre class="nb-text-output">4×4 Array<!-- -->{<!-- -->Float64,2<!-- -->}<!-- -->:<!-- -->
<!-- --> 0.0<!-- -->  <!-- -->4.5<!-- -->  <!-- -->2.0<!-- -->  <!-- -->0.0<!-- -->
<!-- --> 4.0<!-- -->  <!-- -->0.0<!-- -->  <!-- -->3.5<!-- -->  <!-- -->0.0<!-- -->
<!-- --> 0.0<!-- -->  <!-- -->5.0<!-- -->  <!-- -->0.0<!-- -->  <!-- -->2.0<!-- -->
<!-- --> 0.0<!-- -->  <!-- -->3.5<!-- -->  <!-- -->4.0<!-- -->  <!-- -->1.0</pre></div></div><div class="nb-cell nb-markdown-cell"><p>行列の行が上からユーザ 1, 2, 3, 4 に対応し、列が左から商品 1, 2, 3, 4 に対応しているとすると、この行列はユーザ 1 は商品 2 を 4.5、商品 3 を 2.0 と評価し、商品 1 と 4 を評価していないとみなすことができます。なので <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow><mi>K</mi><mo>=</mo><mn>2</mn></mrow>K=2</math></span><span aria-hidden="true" class="katex-html"><span class="base"><span style="height:0.68333em;vertical-align:0em" class="strut"></span><span style="margin-right:0.07153em" class="mord mathnormal">K</span><span style="margin-right:0.2777777777777778em" class="mspace"></span><span class="mrel">=</span><span style="margin-right:0.2777777777777778em" class="mspace"></span></span><span class="base"><span style="height:0.64444em;vertical-align:0em" class="strut"></span><span class="mord">2</span></span></span></span></span> で</p><div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><mrow><mi>Q</mi><mo>=</mo><mrow><mo fence="true">(</mo><mtable rowspacing="0.15999999999999992em"><mtr><mtd><mstyle displaystyle="false" scriptlevel="0"><msub><mi>q</mi><mn>11</mn></msub></mstyle></mtd><mtd><mstyle displaystyle="false" scriptlevel="0"><msub><mi>q</mi><mn>12</mn></msub></mstyle></mtd></mtr><mtr><mtd><mstyle displaystyle="false" scriptlevel="0"><msub><mi>q</mi><mn>21</mn></msub></mstyle></mtd><mtd><mstyle displaystyle="false" scriptlevel="0"><msub><mi>q</mi><mn>22</mn></msub></mstyle></mtd></mtr><mtr><mtd><mstyle displaystyle="false" scriptlevel="0"><msub><mi>q</mi><mn>31</mn></msub></mstyle></mtd><mtd><mstyle displaystyle="false" scriptlevel="0"><msub><mi>q</mi><mn>32</mn></msub></mstyle></mtd></mtr><mtr><mtd><mstyle displaystyle="false" scriptlevel="0"><msub><mi>q</mi><mn>41</mn></msub></mstyle></mtd><mtd><mstyle displaystyle="false" scriptlevel="0"><msub><mi>q</mi><mn>42</mn></msub></mstyle></mtd></mtr></mtable><mo fence="true">)</mo></mrow></mrow>Q = \left( \begin<!-- -->{<!-- -->array<!-- -->}<!-- -->{<!-- -->ccc<!-- -->}<!-- --> q_<!-- -->{<!-- -->11<!-- -->}<!-- --> &amp; q_<!-- -->{<!-- -->12<!-- -->}<!-- --> \\ q_<!-- -->{<!-- -->21<!-- -->}<!-- --> &amp; q_<!-- -->{<!-- -->22<!-- -->}<!-- --> \\ q_<!-- -->{<!-- -->31<!-- -->}<!-- --> &amp; q_<!-- -->{<!-- -->32<!-- -->}<!-- --> \\ q_<!-- -->{<!-- -->41<!-- -->}<!-- --> &amp; q_<!-- -->{<!-- -->42<!-- -->}<!-- --> \end<!-- -->{<!-- -->array<!-- -->}<!-- --> \right)</math></span><span aria-hidden="true" class="katex-html"><span class="base"><span style="height:0.8777699999999999em;vertical-align:-0.19444em" class="strut"></span><span class="mord mathnormal">Q</span><span style="margin-right:0.2777777777777778em" class="mspace"></span><span class="mrel">=</span><span style="margin-right:0.2777777777777778em" class="mspace"></span></span><span class="base"><span style="height:4.80006em;vertical-align:-2.15003em" class="strut"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:2.6500299999999997em" class="vlist"><span style="top:-1.6499900000000003em"><span style="height:3.1550000000000002em" class="pstrut"></span><span class="delimsizinginner delim-size4"><span>⎝</span></span></span><span style="top:-2.8000000000000003em"><span style="height:3.1550000000000002em" class="pstrut"></span><span class="delimsizinginner delim-size4"><span>⎜</span></span></span><span style="top:-3.39501em"><span style="height:3.1550000000000002em" class="pstrut"></span><span class="delimsizinginner delim-size4"><span>⎜</span></span></span><span style="top:-3.41001em"><span style="height:3.1550000000000002em" class="pstrut"></span><span class="delimsizinginner delim-size4"><span>⎜</span></span></span><span style="top:-4.65003em"><span style="height:3.1550000000000002em" class="pstrut"></span><span class="delimsizinginner delim-size4"><span>⎛</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:2.15003em" class="vlist"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span style="width:0.5em" class="arraycolsep"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:2.6500000000000004em" class="vlist"><span style="top:-4.8100000000000005em"><span style="height:3em" class="pstrut"></span><span class="mord"><span class="mord"><span style="margin-right:0.03588em" class="mord mathnormal">q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:0.30110799999999993em" class="vlist"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em"><span style="height:2.7em" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.15em" class="vlist"><span></span></span></span></span></span></span></span></span><span style="top:-3.61em"><span style="height:3em" class="pstrut"></span><span class="mord"><span class="mord"><span style="margin-right:0.03588em" class="mord mathnormal">q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:0.30110799999999993em" class="vlist"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em"><span style="height:2.7em" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.15em" class="vlist"><span></span></span></span></span></span></span></span></span><span style="top:-2.4099999999999997em"><span style="height:3em" class="pstrut"></span><span class="mord"><span class="mord"><span style="margin-right:0.03588em" class="mord mathnormal">q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:0.30110799999999993em" class="vlist"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em"><span style="height:2.7em" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.15em" class="vlist"><span></span></span></span></span></span></span></span></span><span style="top:-1.2099999999999997em"><span style="height:3em" class="pstrut"></span><span class="mord"><span class="mord"><span style="margin-right:0.03588em" class="mord mathnormal">q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:0.30110799999999993em" class="vlist"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em"><span style="height:2.7em" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">4</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.15em" class="vlist"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:2.1500000000000004em" class="vlist"><span></span></span></span></span></span><span style="width:0.5em" class="arraycolsep"></span><span style="width:0.5em" class="arraycolsep"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:2.6500000000000004em" class="vlist"><span style="top:-4.8100000000000005em"><span style="height:3em" class="pstrut"></span><span class="mord"><span class="mord"><span style="margin-right:0.03588em" class="mord mathnormal">q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:0.30110799999999993em" class="vlist"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em"><span style="height:2.7em" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.15em" class="vlist"><span></span></span></span></span></span></span></span></span><span style="top:-3.61em"><span style="height:3em" class="pstrut"></span><span class="mord"><span class="mord"><span style="margin-right:0.03588em" class="mord mathnormal">q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:0.30110799999999993em" class="vlist"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em"><span style="height:2.7em" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.15em" class="vlist"><span></span></span></span></span></span></span></span></span><span style="top:-2.4099999999999997em"><span style="height:3em" class="pstrut"></span><span class="mord"><span class="mord"><span style="margin-right:0.03588em" class="mord mathnormal">q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:0.30110799999999993em" class="vlist"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em"><span style="height:2.7em" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.15em" class="vlist"><span></span></span></span></span></span></span></span></span><span style="top:-1.2099999999999997em"><span style="height:3em" class="pstrut"></span><span class="mord"><span class="mord"><span style="margin-right:0.03588em" class="mord mathnormal">q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:0.30110799999999993em" class="vlist"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em"><span style="height:2.7em" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">4</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.15em" class="vlist"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:2.1500000000000004em" class="vlist"><span></span></span></span></span></span><span style="width:0.5em" class="arraycolsep"></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:2.6500299999999997em" class="vlist"><span style="top:-1.6499900000000003em"><span style="height:3.1550000000000002em" class="pstrut"></span><span class="delimsizinginner delim-size4"><span>⎠</span></span></span><span style="top:-2.8000000000000003em"><span style="height:3.1550000000000002em" class="pstrut"></span><span class="delimsizinginner delim-size4"><span>⎟</span></span></span><span style="top:-3.39501em"><span style="height:3.1550000000000002em" class="pstrut"></span><span class="delimsizinginner delim-size4"><span>⎟</span></span></span><span style="top:-3.41001em"><span style="height:3.1550000000000002em" class="pstrut"></span><span class="delimsizinginner delim-size4"><span>⎟</span></span></span><span style="top:-4.65003em"><span style="height:3.1550000000000002em" class="pstrut"></span><span class="delimsizinginner delim-size4"><span>⎞</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:2.15003em" class="vlist"><span></span></span></span></span></span></span></span></span></span></span></span></div><p>とすると</p><div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><mrow><msub><mi>Q</mi><msub><mi>I</mi><mn>1</mn></msub></msub><mo>=</mo><mrow><mo fence="true">(</mo><mtable rowspacing="0.15999999999999992em"><mtr><mtd><mstyle displaystyle="false" scriptlevel="0"><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle="false" scriptlevel="0"><mn>1</mn></mstyle></mtd><mtd><mstyle displaystyle="false" scriptlevel="0"><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle="false" scriptlevel="0"><mn>0</mn></mstyle></mtd></mtr><mtr><mtd><mstyle displaystyle="false" scriptlevel="0"><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle="false" scriptlevel="0"><mn>0</mn></mstyle></mtd><mtd><mstyle displaystyle="false" scriptlevel="0"><mn>1</mn></mstyle></mtd><mtd><mstyle displaystyle="false" scriptlevel="0"><mn>0</mn></mstyle></mtd></mtr></mtable><mo fence="true">)</mo></mrow><mi>Q</mi><mo>=</mo><mrow><mo fence="true">(</mo><mtable rowspacing="0.15999999999999992em"><mtr><mtd><mstyle displaystyle="false" scriptlevel="0"><msub><mi>q</mi><mn>21</mn></msub></mstyle></mtd><mtd><mstyle displaystyle="false" scriptlevel="0"><msub><mi>q</mi><mn>22</mn></msub></mstyle></mtd></mtr><mtr><mtd><mstyle displaystyle="false" scriptlevel="0"><msub><mi>q</mi><mn>31</mn></msub></mstyle></mtd><mtd><mstyle displaystyle="false" scriptlevel="0"><msub><mi>q</mi><mn>32</mn></msub></mstyle></mtd></mtr></mtable><mo fence="true">)</mo></mrow></mrow>Q_<!-- -->{<!-- -->I_1<!-- -->}<!-- --> = \left( \begin<!-- -->{<!-- -->array<!-- -->}<!-- -->{<!-- -->ccc<!-- -->}<!-- --> 0 &amp; 1 &amp; 0 &amp; 0 \\ 0 &amp; 0 &amp; 1 &amp; 0 \end<!-- -->{<!-- -->array<!-- -->}<!-- --> \right) Q = \left( \begin<!-- -->{<!-- -->array<!-- -->}<!-- -->{<!-- -->ccc<!-- -->}<!-- --> q_<!-- -->{<!-- -->21<!-- -->}<!-- --> &amp; q_<!-- -->{<!-- -->22<!-- -->}<!-- --> \\ q_<!-- -->{<!-- -->31<!-- -->}<!-- --> &amp; q_<!-- -->{<!-- -->32<!-- -->}<!-- --> \end<!-- -->{<!-- -->array<!-- -->}<!-- --> \right)</math></span><span aria-hidden="true" class="katex-html"><span class="base"><span style="height:0.93343em;vertical-align:-0.2501em" class="strut"></span><span class="mord"><span class="mord mathnormal">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:0.32833099999999993em" class="vlist"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em"><span style="height:2.7em" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span style="margin-right:0.07847em" class="mord mathnormal mtight">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:0.31731428571428577em" class="vlist"><span style="top:-2.357em;margin-left:-0.07847em;margin-right:0.07142857142857144em"><span style="height:2.5em" class="pstrut"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.143em" class="vlist"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.2501em" class="vlist"><span></span></span></span></span></span></span><span style="margin-right:0.2777777777777778em" class="mspace"></span><span class="mrel">=</span><span style="margin-right:0.2777777777777778em" class="mspace"></span></span><span class="base"><span style="height:2.40003em;vertical-align:-0.95003em" class="strut"></span><span class="minner"><span style="top:0em" class="mopen delimcenter"><span class="delimsizing size3">(</span></span><span class="mord"><span class="mtable"><span style="width:0.5em" class="arraycolsep"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:1.45em" class="vlist"><span style="top:-3.61em"><span style="height:3em" class="pstrut"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-2.4099999999999997em"><span style="height:3em" class="pstrut"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.9500000000000004em" class="vlist"><span></span></span></span></span></span><span style="width:0.5em" class="arraycolsep"></span><span style="width:0.5em" class="arraycolsep"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:1.45em" class="vlist"><span style="top:-3.61em"><span style="height:3em" class="pstrut"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-2.4099999999999997em"><span style="height:3em" class="pstrut"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.9500000000000004em" class="vlist"><span></span></span></span></span></span><span style="width:0.5em" class="arraycolsep"></span><span style="width:0.5em" class="arraycolsep"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:1.45em" class="vlist"><span style="top:-3.61em"><span style="height:3em" class="pstrut"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-2.4099999999999997em"><span style="height:3em" class="pstrut"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.9500000000000004em" class="vlist"><span></span></span></span></span></span><span style="width:0.5em" class="arraycolsep"></span><span style="width:0.5em" class="arraycolsep"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:1.45em" class="vlist"><span style="top:-3.61em"><span style="height:3em" class="pstrut"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-2.4099999999999997em"><span style="height:3em" class="pstrut"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.9500000000000004em" class="vlist"><span></span></span></span></span></span><span style="width:0.5em" class="arraycolsep"></span></span></span><span style="top:0em" class="mclose delimcenter"><span class="delimsizing size3">)</span></span></span><span style="margin-right:0.16666666666666666em" class="mspace"></span><span class="mord mathnormal">Q</span><span style="margin-right:0.2777777777777778em" class="mspace"></span><span class="mrel">=</span><span style="margin-right:0.2777777777777778em" class="mspace"></span></span><span class="base"><span style="height:2.40003em;vertical-align:-0.95003em" class="strut"></span><span class="minner"><span style="top:0em" class="mopen delimcenter"><span class="delimsizing size3">(</span></span><span class="mord"><span class="mtable"><span style="width:0.5em" class="arraycolsep"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:1.45em" class="vlist"><span style="top:-3.61em"><span style="height:3em" class="pstrut"></span><span class="mord"><span class="mord"><span style="margin-right:0.03588em" class="mord mathnormal">q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:0.30110799999999993em" class="vlist"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em"><span style="height:2.7em" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.15em" class="vlist"><span></span></span></span></span></span></span></span></span><span style="top:-2.4099999999999997em"><span style="height:3em" class="pstrut"></span><span class="mord"><span class="mord"><span style="margin-right:0.03588em" class="mord mathnormal">q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:0.30110799999999993em" class="vlist"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em"><span style="height:2.7em" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.15em" class="vlist"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.9500000000000004em" class="vlist"><span></span></span></span></span></span><span style="width:0.5em" class="arraycolsep"></span><span style="width:0.5em" class="arraycolsep"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:1.45em" class="vlist"><span style="top:-3.61em"><span style="height:3em" class="pstrut"></span><span class="mord"><span class="mord"><span style="margin-right:0.03588em" class="mord mathnormal">q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:0.30110799999999993em" class="vlist"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em"><span style="height:2.7em" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.15em" class="vlist"><span></span></span></span></span></span></span></span></span><span style="top:-2.4099999999999997em"><span style="height:3em" class="pstrut"></span><span class="mord"><span class="mord"><span style="margin-right:0.03588em" class="mord mathnormal">q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:0.30110799999999993em" class="vlist"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em"><span style="height:2.7em" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.15em" class="vlist"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.9500000000000004em" class="vlist"><span></span></span></span></span></span><span style="width:0.5em" class="arraycolsep"></span></span></span><span style="top:0em" class="mclose delimcenter"><span class="delimsizing size3">)</span></span></span></span></span></span></span></div><p>です。この <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow><mi>Q</mi></mrow>Q</math></span><span aria-hidden="true" class="katex-html"><span class="base"><span style="height:0.8777699999999999em;vertical-align:-0.19444em" class="strut"></span><span class="mord mathnormal">Q</span></span></span></span></span> の左からかけているフィルターとなる行列を作る関数を用意します。</p></div><div class="nb-cell nb-code-cell"><div class="nb-input" data-prompt-number="2"><pre class="language-julia"><code class="language-julia" data-language="julia"><span class="token string">&quot;&quot;&quot;<!-- -->
<!-- -->ユーザあるいは商品のレーティングベクトルを受け取って、フィルターとなる行列を返す<!-- -->
<!-- -->&quot;&quot;&quot;</span>
<span class="token keyword">function</span> filtermatrix<span class="token punctuation">(</span>rating<span class="token punctuation">::</span>Array<span class="token punctuation">)</span>
<!-- -->    <!-- -->result <span class="token operator">=</span> zeros<span class="token punctuation">(</span>Int<span class="token punctuation">,</span> <span class="token punctuation">(</span>count<span class="token punctuation">(</span>rating <span class="token punctuation">.</span><span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> length<span class="token punctuation">(</span>rating<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<!-- -->    <!-- -->counter <span class="token operator">=</span> <span class="token number">1</span>
<!-- -->    <span class="token keyword">for</span> <span class="token punctuation">(</span>index<span class="token punctuation">,</span> value<span class="token punctuation">)</span> <span class="token keyword">in</span> enumerate<span class="token punctuation">(</span>rating<span class="token punctuation">)</span>
<!-- -->        <span class="token keyword">if</span> value <span class="token operator">!=</span> <span class="token number">0</span>
<!-- -->            <!-- -->result<span class="token punctuation">[</span>counter<span class="token punctuation">,</span> index<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>
<!-- -->            <!-- -->counter <span class="token operator">+=</span> <span class="token number">1</span>
<!-- -->        <span class="token keyword">end</span>
<!-- -->    <span class="token keyword">end</span>
<!-- -->    <!-- -->result<!-- -->
<span class="token keyword">end</span></code></pre></div><div class="nb-output" data-prompt-number="2"><pre class="nb-text-output">filtermatrix</pre></div></div><div class="nb-cell nb-markdown-cell"><p>ユーザ 1 のレーティングを入力として与えると、たしかにさきほど <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow><mi>Q</mi></mrow>Q</math></span><span aria-hidden="true" class="katex-html"><span class="base"><span style="height:0.8777699999999999em;vertical-align:-0.19444em" class="strut"></span><span class="mord mathnormal">Q</span></span></span></span></span> にかけたものと同じ行列が返ってきます。<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow><msub><mi mathvariant="bold">q</mi><mi>i</mi></msub></mrow>\mathbf<!-- -->{<!-- -->q<!-- -->}<!-- -->_i</math></span><span aria-hidden="true" class="katex-html"><span class="base"><span style="height:0.63888em;vertical-align:-0.19444em" class="strut"></span><span class="mord"><span class="mord"><span class="mord mathbf">q</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:0.31166399999999994em" class="vlist"><span style="top:-2.5500000000000003em;margin-right:0.05em"><span style="height:2.7em" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.15em" class="vlist"><span></span></span></span></span></span></span></span></span></span></span> を更新する時に必要になる <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow><msub><mi>P</mi><msub><mi>I</mi><mi>i</mi></msub></msub></mrow>P_<!-- -->{<!-- -->I_i<!-- -->}</math></span><span aria-hidden="true" class="katex-html"><span class="base"><span style="height:0.93343em;vertical-align:-0.2501em" class="strut"></span><span class="mord"><span style="margin-right:0.13889em" class="mord mathnormal">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:0.32833099999999993em" class="vlist"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em"><span style="height:2.7em" class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span style="margin-right:0.07847em" class="mord mathnormal mtight">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span style="height:0.3280857142857143em" class="vlist"><span style="top:-2.357em;margin-left:-0.07847em;margin-right:0.07142857142857144em"><span style="height:2.5em" class="pstrut"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.143em" class="vlist"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span style="height:0.2501em" class="vlist"><span></span></span></span></span></span></span></span></span></span></span> も同様に求めることができます：</p></div><div class="nb-cell nb-code-cell"><div class="nb-input" data-prompt-number="3"><pre class="language-julia"><code class="language-julia" data-language="julia">filtermatrix<span class="token punctuation">(</span>R<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre></div><div class="nb-output" data-prompt-number="3"><pre class="nb-text-output">2×4 Array<!-- -->{<!-- -->Int64,2<!-- -->}<!-- -->:<!-- -->
<!-- --> 0<!-- -->  <!-- -->1<!-- -->  <!-- -->0<!-- -->  <!-- -->0<!-- -->
<!-- --> 0<!-- -->  <!-- -->0<!-- -->  <!-- -->1<!-- -->  <!-- -->0</pre></div></div><div class="nb-cell nb-markdown-cell"><p>本筋からは離れますが、 ALS の中で使うために MSE を計算する関数を用意しておきます：</p></div><div class="nb-cell nb-code-cell"><div class="nb-input" data-prompt-number="4"><pre class="language-julia"><code class="language-julia" data-language="julia"><span class="token string">&quot;&quot;&quot;<!-- -->
<!-- -->ベクトル x と ｙ の平均二乗誤差を計算する<!-- -->
<!-- -->
<!-- -->x: ベクトル<!-- -->
<!-- -->y: ベクトル<!-- -->
<!-- -->&quot;&quot;&quot;</span>
<span class="token keyword">function</span> mse<span class="token punctuation">(</span>x<span class="token punctuation">::</span>Vector<span class="token punctuation">,</span> y<span class="token punctuation">::</span>Vector<span class="token punctuation">)</span><span class="token punctuation">::</span>Float64<!-- -->
<!-- -->    <!-- -->@assert length<span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">==</span> length<span class="token punctuation">(</span>y<span class="token punctuation">)</span>
<!-- -->    <!-- -->sum<span class="token punctuation">(</span><span class="token punctuation">(</span>x <span class="token punctuation">.</span><span class="token operator">-</span> y<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token operator">^</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">/</span> length<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
<span class="token keyword">end</span></code></pre></div><div class="nb-output" data-prompt-number="4"><pre class="nb-text-output">mse</pre></div></div><div class="nb-cell nb-markdown-cell"><p>では ALS を実装します。さきほどの更新式をそのままコードにおとしていくだけです。</p></div><div class="nb-cell nb-code-cell"><div class="nb-input" data-prompt-number="5"><pre class="language-julia"><code class="language-julia" data-language="julia"><span class="token keyword">using</span> LinearAlgebra<!-- -->
<!-- -->
<span class="token string">&quot;&quot;&quot;<!-- -->
<!-- -->R: レーティング行列<!-- -->
<!-- -->rank: 潜在因子の数<!-- -->
<!-- -->iter: 反復回数<!-- -->
<!-- -->λ: 正規化パラメータ<!-- -->
<!-- -->&quot;&quot;&quot;</span>
<span class="token keyword">function</span> als<span class="token punctuation">(</span>
<!-- -->        <!-- -->R<span class="token punctuation">::</span>Matrix<span class="token punctuation">;</span>
<!-- -->        <!-- -->rank<span class="token punctuation">::</span>Int<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span>
<!-- -->        <!-- -->iter<span class="token punctuation">::</span>Int<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span>
<!-- -->        <!-- -->λ<span class="token punctuation">::</span>Float64<span class="token operator">=</span><span class="token number">0.001</span>
<!-- -->    <span class="token punctuation">)</span>
<!-- -->    <!-- -->usersnum <span class="token operator">=</span> size<span class="token punctuation">(</span>R<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment"># ユーザ数</span>
<!-- -->    <!-- -->itemsnum <span class="token operator">=</span> size<span class="token punctuation">(</span>R<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>  <span class="token comment"># 商品数</span>
<!-- -->    <!-- -->
<!-- -->    <!-- -->P <span class="token operator">=</span> rand<span class="token punctuation">(</span>usersnum<span class="token punctuation">,</span> rank<span class="token punctuation">)</span>  <span class="token comment"># ユーザ因子行列</span>
<!-- -->    <!-- -->Q <span class="token operator">=</span> rand<span class="token punctuation">(</span>itemsnum<span class="token punctuation">,</span> rank<span class="token punctuation">)</span>  <span class="token comment"># 商品因子行列</span>
<!-- -->    <!-- -->
<!-- -->    <span class="token comment"># 各ユーザと商品の評価数</span>
<!-- -->    <!-- -->np <span class="token operator">=</span> <span class="token punctuation">[</span>count<span class="token punctuation">(</span>R<span class="token punctuation">[</span>u<span class="token punctuation">:</span>u<span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token punctuation">.</span><span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">for</span> u <span class="token keyword">in</span> <span class="token number">1</span><span class="token punctuation">:</span>usersnum<span class="token punctuation">]</span>
<!-- -->    <!-- -->nq <span class="token operator">=</span> <span class="token punctuation">[</span>count<span class="token punctuation">(</span>R<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> i<span class="token punctuation">:</span>i<span class="token punctuation">]</span> <span class="token punctuation">.</span><span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token number">1</span><span class="token punctuation">:</span>itemsnum<span class="token punctuation">]</span>
<!-- -->
<!-- -->    <span class="token comment"># 各ユーザと商品のフィルター行列</span>
<!-- -->    <!-- -->Iu <span class="token operator">=</span> <span class="token punctuation">[</span>filtermatrix<span class="token punctuation">(</span>R<span class="token punctuation">[</span>u<span class="token punctuation">:</span>u<span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">for</span> u <span class="token keyword">in</span> <span class="token number">1</span><span class="token punctuation">:</span>usersnum<span class="token punctuation">]</span>
<!-- -->    <!-- -->Ii <span class="token operator">=</span> <span class="token punctuation">[</span>filtermatrix<span class="token punctuation">(</span>R<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> i<span class="token punctuation">:</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token number">1</span><span class="token punctuation">:</span>itemsnum<span class="token punctuation">]</span>
<!-- -->    <!-- -->
<!-- -->    <!-- -->x <span class="token operator">=</span> R<span class="token punctuation">[</span>R <span class="token punctuation">.</span><span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">]</span> <span class="token comment"># レーティング行列のうち 0 ではないもの</span>
<!-- -->    <!-- -->losses <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token comment"># 各イテレーションごとの mse の値を入れる</span>
<!-- -->    <!-- -->
<!-- -->    <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token number">1</span><span class="token punctuation">:</span>iter<!-- -->
<!-- -->        <span class="token comment"># ユーザ因子を更新する</span>
<!-- -->        <span class="token keyword">for</span> u <span class="token keyword">in</span> <span class="token number">1</span><span class="token punctuation">:</span>usersnum<!-- -->
<!-- -->            <!-- -->QIu <span class="token operator">=</span> <span class="token punctuation">(</span>Iu<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">*</span> Q<span class="token punctuation">)</span><span class="token operator">&#x27;</span>
<!-- -->            <!-- -->Au <span class="token operator">=</span> QIu <span class="token operator">*</span> QIu<span class="token operator">&#x27;</span>  <span class="token operator">+</span> λ <span class="token operator">*</span> np<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">*</span> I<!-- -->
<!-- -->            <!-- -->Vu <span class="token operator">=</span> QIu <span class="token operator">*</span> Iu<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token punctuation">(</span>R<span class="token punctuation">[</span>u<span class="token punctuation">:</span>u<span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">&#x27;</span>
<!-- -->            <!-- -->P<span class="token punctuation">[</span>u<span class="token punctuation">:</span>u<span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token operator">=</span> inv<span class="token punctuation">(</span>Au<span class="token punctuation">)</span> <span class="token operator">*</span> Vu<!-- -->
<!-- -->        <span class="token keyword">end</span>
<!-- -->        <!-- -->
<!-- -->        <span class="token comment"># 商品因子を更新する</span>
<!-- -->        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token number">1</span><span class="token punctuation">:</span>itemsnum<!-- -->
<!-- -->            <!-- -->PIi <span class="token operator">=</span> <span class="token punctuation">(</span>Ii<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">*</span> P<span class="token punctuation">)</span><span class="token operator">&#x27;</span>
<!-- -->            <!-- -->Ai <span class="token operator">=</span> PIi <span class="token operator">*</span> PIi<span class="token operator">&#x27;</span> <span class="token operator">+</span> λ <span class="token operator">*</span> nq<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">*</span> I<!-- -->
<!-- -->            <!-- -->Vi <span class="token operator">=</span> PIi <span class="token operator">*</span> Ii<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">*</span> R<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> i<span class="token punctuation">:</span>i<span class="token punctuation">]</span>
<!-- -->            <!-- -->Q<span class="token punctuation">[</span>i<span class="token punctuation">:</span>i<span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token operator">=</span> inv<span class="token punctuation">(</span>Ai<span class="token punctuation">)</span> <span class="token operator">*</span> Vi<!-- -->
<!-- -->        <span class="token keyword">end</span>
<!-- -->        <!-- -->
<!-- -->        <span class="token comment"># 推定された R</span>
<!-- -->        <!-- -->R̂ <span class="token operator">=</span> P <span class="token operator">*</span> Q<span class="token operator">&#x27;</span>
<!-- -->        <span class="token comment">#<!-- -->  <!-- -->R̂ のうちレーティング行列で 0 ではない要素に対応するもの</span>
<!-- -->        <!-- -->y <span class="token operator">=</span> R̂<span class="token punctuation">[</span>R <span class="token punctuation">.</span><span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">]</span>
<!-- -->        <!-- -->push<span class="token operator">!</span><span class="token punctuation">(</span>losses<span class="token punctuation">,</span> mse<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">)</span>
<!-- -->    <span class="token keyword">end</span>
<!-- -->    <!-- -->
<!-- -->    <!-- -->P<span class="token punctuation">,</span> Q<span class="token punctuation">,</span> losses<!-- -->
<span class="token keyword">end</span></code></pre></div><div class="nb-output" data-prompt-number="5"><pre class="nb-text-output">als</pre></div></div><div class="nb-cell nb-markdown-cell"><h2>動作確認</h2><p>実際に計算してみます：</p></div><div class="nb-cell nb-code-cell"><div class="nb-input" data-prompt-number="6"><pre class="language-julia"><code class="language-julia" data-language="julia"><span class="token keyword">using</span> Random<!-- -->
<!-- -->Random<span class="token punctuation">.</span>seed<span class="token operator">!</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span>
<!-- -->P<span class="token punctuation">,</span> Q<span class="token punctuation">,</span> losses <span class="token operator">=</span> als<span class="token punctuation">(</span>R<span class="token punctuation">)</span>
<!-- -->R̂ <span class="token operator">=</span> P <span class="token operator">*</span> Q<span class="token operator">&#x27;</span></code></pre></div><div class="nb-output" data-prompt-number="6"><pre class="nb-text-output">4×4 Array<!-- -->{<!-- -->Float64,2<!-- -->}<!-- -->:<!-- -->
<!-- --> 1.95614<!-- -->  <!-- -->4.49856<!-- -->  <!-- -->2.00126<!-- -->  <!-- -->1.93523 <!-- -->
<!-- --> 3.99916<!-- -->  <!-- -->2.49496<!-- -->  <!-- -->3.5<!-- -->      <!-- -->0.577751<!-- -->
<!-- --> 2.59633<!-- -->  <!-- -->5.00034<!-- -->  <!-- -->2.96279<!-- -->  <!-- -->1.99935 <!-- -->
<!-- --> 2.92678<!-- -->  <!-- -->3.49851<!-- -->  <!-- -->3.99614<!-- -->  <!-- -->1.00025 </pre></div></div><div class="nb-cell nb-markdown-cell"><p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow><mi>R</mi></mrow>R</math></span><span aria-hidden="true" class="katex-html"><span class="base"><span style="height:0.68333em;vertical-align:0em" class="strut"></span><span style="margin-right:0.00773em" class="mord mathnormal">R</span></span></span></span></span> と <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow><mover accent="true"><mi>R</mi><mo>^</mo></mover></mrow>\hat<!-- -->{<!-- -->R<!-- -->}</math></span><span aria-hidden="true" class="katex-html"><span class="base"><span style="height:0.9467699999999999em;vertical-align:0em" class="strut"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span style="height:0.9467699999999999em" class="vlist"><span style="top:-3em"><span style="height:3em" class="pstrut"></span><span class="mord"><span style="margin-right:0.00773em" class="mord mathnormal">R</span></span></span><span style="top:-3.25233em"><span style="height:3em" class="pstrut"></span><span style="left:-0.16666em" class="accent-body"><span class="mord">^</span></span></span></span></span></span></span></span></span></span></span> から <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow><mi>I</mi></mrow>I</math></span><span aria-hidden="true" class="katex-html"><span class="base"><span style="height:0.68333em;vertical-align:0em" class="strut"></span><span style="margin-right:0.07847em" class="mord mathnormal">I</span></span></span></span></span> に含まれるものを取り出してみると、かなり近い値が並んでいることが分かります：</p></div><div class="nb-cell nb-code-cell"><div class="nb-input" data-prompt-number="7"><pre class="language-julia"><code class="language-julia" data-language="julia"><span class="token keyword">println</span><span class="token punctuation">(</span><span class="token string">&quot;R = &quot;</span><span class="token punctuation">,</span> R<span class="token punctuation">[</span>R <span class="token punctuation">.</span><span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">println</span><span class="token punctuation">(</span><span class="token string">&quot;R̂ = &quot;</span><span class="token punctuation">,</span> round<span class="token punctuation">.</span><span class="token punctuation">(</span>R̂<span class="token punctuation">[</span>R <span class="token punctuation">.</span><span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> digits<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre></div><div class="nb-output" data-prompt-number="7"><pre class="nb-stdout">R = [4.0, 4.5, 5.0, 3.5, 2.0, 3.5, 4.0, 2.0, 1.0]<!-- -->
<!-- -->R̂ = [3.999, 4.499, 5.0, 3.499, 2.001, 3.5, 3.996, 1.999, 1.0]<!-- -->
</pre></div></div><div class="nb-cell nb-markdown-cell"><p>誤差の遷移をグラフに表示してみると、反復すると急激に値が小さくなっていくことが分かります。今回使ったレーティング行列はとても小さいので数回の反復で収束しています：</p></div><div class="nb-cell nb-code-cell"><div class="nb-input" data-prompt-number="8"><pre class="language-julia"><code class="language-julia" data-language="julia"><span class="token keyword">using</span> Plots<!-- -->
<!-- -->Plots<span class="token punctuation">.</span>gr<span class="token punctuation">(</span><span class="token punctuation">)</span>
<!-- -->plot<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">10</span><span class="token punctuation">,</span> losses<span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">&quot;Losses&quot;</span><span class="token punctuation">,</span> yscale<span class="token operator">=</span><span class="token punctuation">:</span>log10<span class="token punctuation">)</span></code></pre></div><div class="nb-output" data-prompt-number="8"><div class="nb-svg-output"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="600" height="400" viewBox="0 0 2400 1600"><defs><clipPath id="clip7900"><rect x="0" y="0" width="2400" height="1600"></rect></clipPath></defs><path clip-path="url(#clip7900)" d="
M0 1600 L2400 1600 L2400 0 L0 0  Z " fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path><defs><clipPath id="clip7901"><rect x="480" y="0" width="1681" height="1600"></rect></clipPath></defs><path clip-path="url(#clip7900)" d="
M284.87 1487.47 L2352.76 1487.47 L2352.76 47.2441 L284.87 47.2441  Z " fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path><defs><clipPath id="clip7902"><rect x="284" y="47" width="2069" height="1441"></rect></clipPath></defs><polyline clip-path="url(#clip7902)" style="stroke:#000000;stroke-width:2;stroke-opacity:0.1;fill:none" points=" 560.154,1487.47 560.154,47.2441  "></polyline><polyline clip-path="url(#clip7902)" style="stroke:#000000;stroke-width:2;stroke-opacity:0.1;fill:none" points=" 993.674,1487.47 993.674,47.2441  "></polyline><polyline clip-path="url(#clip7902)" style="stroke:#000000;stroke-width:2;stroke-opacity:0.1;fill:none" points=" 1427.19,1487.47 1427.19,47.2441  "></polyline><polyline clip-path="url(#clip7902)" style="stroke:#000000;stroke-width:2;stroke-opacity:0.1;fill:none" points=" 1860.71,1487.47 1860.71,47.2441  "></polyline><polyline clip-path="url(#clip7902)" style="stroke:#000000;stroke-width:2;stroke-opacity:0.1;fill:none" points=" 2294.23,1487.47 2294.23,47.2441  "></polyline><polyline clip-path="url(#clip7902)" style="stroke:#000000;stroke-width:2;stroke-opacity:0.1;fill:none" points=" 284.87,1287.93 2352.76,1287.93  "></polyline><polyline clip-path="url(#clip7902)" style="stroke:#000000;stroke-width:2;stroke-opacity:0.1;fill:none" points=" 284.87,964.853 2352.76,964.853  "></polyline><polyline clip-path="url(#clip7902)" style="stroke:#000000;stroke-width:2;stroke-opacity:0.1;fill:none" points=" 284.87,641.779 2352.76,641.779  "></polyline><polyline clip-path="url(#clip7902)" style="stroke:#000000;stroke-width:2;stroke-opacity:0.1;fill:none" points=" 284.87,318.705 2352.76,318.705  "></polyline><polyline clip-path="url(#clip7900)" style="stroke:#000000;stroke-width:4;stroke-opacity:1;fill:none" points=" 284.87,1487.47 2352.76,1487.47  "></polyline><polyline clip-path="url(#clip7900)" style="stroke:#000000;stroke-width:4;stroke-opacity:1;fill:none" points=" 284.87,1487.47 284.87,47.2441  "></polyline><polyline clip-path="url(#clip7900)" style="stroke:#000000;stroke-width:4;stroke-opacity:1;fill:none" points=" 560.154,1487.47 560.154,1470.19  "></polyline><polyline clip-path="url(#clip7900)" style="stroke:#000000;stroke-width:4;stroke-opacity:1;fill:none" points=" 993.674,1487.47 993.674,1470.19  "></polyline><polyline clip-path="url(#clip7900)" style="stroke:#000000;stroke-width:4;stroke-opacity:1;fill:none" points=" 1427.19,1487.47 1427.19,1470.19  "></polyline><polyline clip-path="url(#clip7900)" style="stroke:#000000;stroke-width:4;stroke-opacity:1;fill:none" points=" 1860.71,1487.47 1860.71,1470.19  "></polyline><polyline clip-path="url(#clip7900)" style="stroke:#000000;stroke-width:4;stroke-opacity:1;fill:none" points=" 2294.23,1487.47 2294.23,1470.19  "></polyline><polyline clip-path="url(#clip7900)" style="stroke:#000000;stroke-width:4;stroke-opacity:1;fill:none" points=" 284.87,1287.93 309.684,1287.93  "></polyline><polyline clip-path="url(#clip7900)" style="stroke:#000000;stroke-width:4;stroke-opacity:1;fill:none" points=" 284.87,964.853 309.684,964.853  "></polyline><polyline clip-path="url(#clip7900)" style="stroke:#000000;stroke-width:4;stroke-opacity:1;fill:none" points=" 284.87,641.779 309.684,641.779  "></polyline><polyline clip-path="url(#clip7900)" style="stroke:#000000;stroke-width:4;stroke-opacity:1;fill:none" points=" 284.87,318.705 309.684,318.705  "></polyline><g clip-path="url(#clip7900)"><text style="fill:#000000;fill-opacity:1;font-family:Arial,Helvetica Neue,Helvetica,sans-serif;font-size:48px;text-anchor:middle" transform="rotate(0, 560.154, 1541.47)" x="560.154" y="1541.47">2</text></g><g clip-path="url(#clip7900)"><text style="fill:#000000;fill-opacity:1;font-family:Arial,Helvetica Neue,Helvetica,sans-serif;font-size:48px;text-anchor:middle" transform="rotate(0, 993.674, 1541.47)" x="993.674" y="1541.47">4</text></g><g clip-path="url(#clip7900)"><text style="fill:#000000;fill-opacity:1;font-family:Arial,Helvetica Neue,Helvetica,sans-serif;font-size:48px;text-anchor:middle" transform="rotate(0, 1427.19, 1541.47)" x="1427.19" y="1541.47">6</text></g><g clip-path="url(#clip7900)"><text style="fill:#000000;fill-opacity:1;font-family:Arial,Helvetica Neue,Helvetica,sans-serif;font-size:48px;text-anchor:middle" transform="rotate(0, 1860.71, 1541.47)" x="1860.71" y="1541.47">8</text></g><g clip-path="url(#clip7900)"><text style="fill:#000000;fill-opacity:1;font-family:Arial,Helvetica Neue,Helvetica,sans-serif;font-size:48px;text-anchor:middle" transform="rotate(0, 2294.23, 1541.47)" x="2294.23" y="1541.47">10</text></g><g clip-path="url(#clip7900)"><text style="fill:#000000;fill-opacity:1;font-family:Arial,Helvetica Neue,Helvetica,sans-serif;font-size:48px;text-anchor:start" transform="rotate(0, 97.5281, 1311.65)" x="97.5281" y="1311.65">10</text></g><g clip-path="url(#clip7900)"><text style="fill:#000000;fill-opacity:1;font-family:Arial,Helvetica Neue,Helvetica,sans-serif;font-size:38px;text-anchor:start" transform="rotate(0, 151.053, 1284.24)" x="151.053" y="1284.24">-</text></g><g clip-path="url(#clip7900)"><text style="fill:#000000;fill-opacity:1;font-family:Arial,Helvetica Neue,Helvetica,sans-serif;font-size:38px;text-anchor:start" transform="rotate(0, 173.892, 1284.24)" x="173.892" y="1284.24">5.50 </text></g><g clip-path="url(#clip7900)"><text style="fill:#000000;fill-opacity:1;font-family:Arial,Helvetica Neue,Helvetica,sans-serif;font-size:48px;text-anchor:start" transform="rotate(0, 97.5281, 988.58)" x="97.5281" y="988.58">10</text></g><g clip-path="url(#clip7900)"><text style="fill:#000000;fill-opacity:1;font-family:Arial,Helvetica Neue,Helvetica,sans-serif;font-size:38px;text-anchor:start" transform="rotate(0, 151.053, 961.17)" x="151.053" y="961.17">-</text></g><g clip-path="url(#clip7900)"><text style="fill:#000000;fill-opacity:1;font-family:Arial,Helvetica Neue,Helvetica,sans-serif;font-size:38px;text-anchor:start" transform="rotate(0, 173.892, 961.17)" x="173.892" y="961.17">5.25 </text></g><g clip-path="url(#clip7900)"><text style="fill:#000000;fill-opacity:1;font-family:Arial,Helvetica Neue,Helvetica,sans-serif;font-size:48px;text-anchor:start" transform="rotate(0, 97.5281, 665.506)" x="97.5281" y="665.506">10</text></g><g clip-path="url(#clip7900)"><text style="fill:#000000;fill-opacity:1;font-family:Arial,Helvetica Neue,Helvetica,sans-serif;font-size:38px;text-anchor:start" transform="rotate(0, 151.053, 638.096)" x="151.053" y="638.096">-</text></g><g clip-path="url(#clip7900)"><text style="fill:#000000;fill-opacity:1;font-family:Arial,Helvetica Neue,Helvetica,sans-serif;font-size:38px;text-anchor:start" transform="rotate(0, 173.892, 638.096)" x="173.892" y="638.096">5.00 </text></g><g clip-path="url(#clip7900)"><text style="fill:#000000;fill-opacity:1;font-family:Arial,Helvetica Neue,Helvetica,sans-serif;font-size:48px;text-anchor:start" transform="rotate(0, 97.5281, 342.432)" x="97.5281" y="342.432">10</text></g><g clip-path="url(#clip7900)"><text style="fill:#000000;fill-opacity:1;font-family:Arial,Helvetica Neue,Helvetica,sans-serif;font-size:38px;text-anchor:start" transform="rotate(0, 151.053, 315.022)" x="151.053" y="315.022">-</text></g><g clip-path="url(#clip7900)"><text style="fill:#000000;fill-opacity:1;font-family:Arial,Helvetica Neue,Helvetica,sans-serif;font-size:38px;text-anchor:start" transform="rotate(0, 173.892, 315.022)" x="173.892" y="315.022">4.75 </text></g><polyline clip-path="url(#clip7902)" style="stroke:#009af9;stroke-width:4;stroke-opacity:1;fill:none" points=" 343.395,88.0053 560.154,1359.7 776.914,1432.09 993.674,1444.45 1210.43,1446.71 1427.19,1444.97 1643.95,1441.22 1860.71,1436.86 2077.47,1432.86 2294.23,1429.89  "></polyline><path clip-path="url(#clip7900)" d="
M1888.27 251.724 L2280.76 251.724 L2280.76 130.764 L1888.27 130.764  Z " fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path><polyline clip-path="url(#clip7900)" style="stroke:#000000;stroke-width:4;stroke-opacity:1;fill:none" points=" 1888.27,251.724 2280.76,251.724 2280.76,130.764 1888.27,130.764 1888.27,251.724  "></polyline><polyline clip-path="url(#clip7900)" style="stroke:#009af9;stroke-width:4;stroke-opacity:1;fill:none" points=" 1912.27,191.244 2056.27,191.244  "></polyline><g clip-path="url(#clip7900)"><text style="fill:#000000;fill-opacity:1;font-family:Arial,Helvetica Neue,Helvetica,sans-serif;font-size:48px;text-anchor:start" transform="rotate(0, 2080.27, 208.744)" x="2080.27" y="208.744">Losses</text></g></svg></div></div></div><div class="nb-cell nb-markdown-cell"><p>ユーザ数と商品数ともに 100 くらいのもっと大きなデータを使ってみます：</p></div><div class="nb-cell nb-code-cell"><div class="nb-input" data-prompt-number="9"><pre class="language-julia"><code class="language-julia" data-language="julia">R2 <span class="token operator">=</span> zeros<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> u <span class="token keyword">in</span> <span class="token number">1</span><span class="token punctuation">:</span><span class="token number">100</span><span class="token punctuation">,</span> p <span class="token keyword">in</span> <span class="token number">1</span><span class="token punctuation">:</span><span class="token number">100</span>
<!-- -->    <span class="token keyword">if</span> rand<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0.1</span>
<!-- -->        <!-- -->R2<span class="token punctuation">[</span>u<span class="token punctuation">,</span> p<span class="token punctuation">]</span> <span class="token operator">=</span> rand<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">5</span>
<!-- -->    <span class="token keyword">end</span>
<span class="token keyword">end</span></code></pre></div></div><div class="nb-cell nb-markdown-cell"><p>収束が緩やかになっていることが分かります：</p></div><div class="nb-cell nb-code-cell"><div class="nb-input" data-prompt-number="10"><pre class="language-julia"><code class="language-julia" data-language="julia">iter <span class="token operator">=</span> <span class="token number">100</span>
<!-- -->_<span class="token punctuation">,</span> _<span class="token punctuation">,</span> losses2 <span class="token operator">=</span> als<span class="token punctuation">(</span>R2<span class="token punctuation">,</span> iter<span class="token operator">=</span>iter<span class="token punctuation">)</span>
<!-- -->Plots<span class="token punctuation">.</span>gr<span class="token punctuation">(</span><span class="token punctuation">)</span>
<!-- -->plot<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">:</span>iter<span class="token punctuation">,</span> losses2<span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">&quot;Losses&quot;</span><span class="token punctuation">,</span> yscale<span class="token operator">=</span><span class="token punctuation">:</span>log10<span class="token punctuation">)</span></code></pre></div><div class="nb-output" data-prompt-number="10"><div class="nb-svg-output"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="600" height="400" viewBox="0 0 2400 1600"><defs><clipPath id="clip8300"><rect x="0" y="0" width="2400" height="1600"></rect></clipPath></defs><path clip-path="url(#clip8300)" d="
M0 1600 L2400 1600 L2400 0 L0 0  Z " fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path><defs><clipPath id="clip8301"><rect x="480" y="0" width="1681" height="1600"></rect></clipPath></defs><path clip-path="url(#clip8300)" d="
M217.964 1487.47 L2352.76 1487.47 L2352.76 47.2441 L217.964 47.2441  Z " fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path><defs><clipPath id="clip8302"><rect x="217" y="47" width="2136" height="1441"></rect></clipPath></defs><polyline clip-path="url(#clip8302)" style="stroke:#000000;stroke-width:2;stroke-opacity:0.1;fill:none" points=" 258.04,1487.47 258.04,47.2441  "></polyline><polyline clip-path="url(#clip8302)" style="stroke:#000000;stroke-width:2;stroke-opacity:0.1;fill:none" points=" 766.614,1487.47 766.614,47.2441  "></polyline><polyline clip-path="url(#clip8302)" style="stroke:#000000;stroke-width:2;stroke-opacity:0.1;fill:none" points=" 1275.19,1487.47 1275.19,47.2441  "></polyline><polyline clip-path="url(#clip8302)" style="stroke:#000000;stroke-width:2;stroke-opacity:0.1;fill:none" points=" 1783.76,1487.47 1783.76,47.2441  "></polyline><polyline clip-path="url(#clip8302)" style="stroke:#000000;stroke-width:2;stroke-opacity:0.1;fill:none" points=" 2292.34,1487.47 2292.34,47.2441  "></polyline><polyline clip-path="url(#clip8302)" style="stroke:#000000;stroke-width:2;stroke-opacity:0.1;fill:none" points=" 217.964,1477.91 2352.76,1477.91  "></polyline><polyline clip-path="url(#clip8302)" style="stroke:#000000;stroke-width:2;stroke-opacity:0.1;fill:none" points=" 217.964,1082.99 2352.76,1082.99  "></polyline><polyline clip-path="url(#clip8302)" style="stroke:#000000;stroke-width:2;stroke-opacity:0.1;fill:none" points=" 217.964,688.059 2352.76,688.059  "></polyline><polyline clip-path="url(#clip8302)" style="stroke:#000000;stroke-width:2;stroke-opacity:0.1;fill:none" points=" 217.964,293.132 2352.76,293.132  "></polyline><polyline clip-path="url(#clip8300)" style="stroke:#000000;stroke-width:4;stroke-opacity:1;fill:none" points=" 217.964,1487.47 2352.76,1487.47  "></polyline><polyline clip-path="url(#clip8300)" style="stroke:#000000;stroke-width:4;stroke-opacity:1;fill:none" points=" 217.964,1487.47 217.964,47.2441  "></polyline><polyline clip-path="url(#clip8300)" style="stroke:#000000;stroke-width:4;stroke-opacity:1;fill:none" points=" 258.04,1487.47 258.04,1470.19  "></polyline><polyline clip-path="url(#clip8300)" style="stroke:#000000;stroke-width:4;stroke-opacity:1;fill:none" points=" 766.614,1487.47 766.614,1470.19  "></polyline><polyline clip-path="url(#clip8300)" style="stroke:#000000;stroke-width:4;stroke-opacity:1;fill:none" points=" 1275.19,1487.47 1275.19,1470.19  "></polyline><polyline clip-path="url(#clip8300)" style="stroke:#000000;stroke-width:4;stroke-opacity:1;fill:none" points=" 1783.76,1487.47 1783.76,1470.19  "></polyline><polyline clip-path="url(#clip8300)" style="stroke:#000000;stroke-width:4;stroke-opacity:1;fill:none" points=" 2292.34,1487.47 2292.34,1470.19  "></polyline><polyline clip-path="url(#clip8300)" style="stroke:#000000;stroke-width:4;stroke-opacity:1;fill:none" points=" 217.964,1477.91 243.581,1477.91  "></polyline><polyline clip-path="url(#clip8300)" style="stroke:#000000;stroke-width:4;stroke-opacity:1;fill:none" points=" 217.964,1082.99 243.581,1082.99  "></polyline><polyline clip-path="url(#clip8300)" style="stroke:#000000;stroke-width:4;stroke-opacity:1;fill:none" points=" 217.964,688.059 243.581,688.059  "></polyline><polyline clip-path="url(#clip8300)" style="stroke:#000000;stroke-width:4;stroke-opacity:1;fill:none" points=" 217.964,293.132 243.581,293.132  "></polyline><g clip-path="url(#clip8300)"><text style="fill:#000000;fill-opacity:1;font-family:Arial,Helvetica Neue,Helvetica,sans-serif;font-size:48px;text-anchor:middle" transform="rotate(0, 258.04, 1541.47)" x="258.04" y="1541.47">0</text></g><g clip-path="url(#clip8300)"><text style="fill:#000000;fill-opacity:1;font-family:Arial,Helvetica Neue,Helvetica,sans-serif;font-size:48px;text-anchor:middle" transform="rotate(0, 766.614, 1541.47)" x="766.614" y="1541.47">25</text></g><g clip-path="url(#clip8300)"><text style="fill:#000000;fill-opacity:1;font-family:Arial,Helvetica Neue,Helvetica,sans-serif;font-size:48px;text-anchor:middle" transform="rotate(0, 1275.19, 1541.47)" x="1275.19" y="1541.47">50</text></g><g clip-path="url(#clip8300)"><text style="fill:#000000;fill-opacity:1;font-family:Arial,Helvetica Neue,Helvetica,sans-serif;font-size:48px;text-anchor:middle" transform="rotate(0, 1783.76, 1541.47)" x="1783.76" y="1541.47">75</text></g><g clip-path="url(#clip8300)"><text style="fill:#000000;fill-opacity:1;font-family:Arial,Helvetica Neue,Helvetica,sans-serif;font-size:48px;text-anchor:middle" transform="rotate(0, 2292.34, 1541.47)" x="2292.34" y="1541.47">100</text></g><g clip-path="url(#clip8300)"><text style="fill:#000000;fill-opacity:1;font-family:Arial,Helvetica Neue,Helvetica,sans-serif;font-size:48px;text-anchor:start" transform="rotate(0, 84.9832, 1501.64)" x="84.9832" y="1501.64">10</text></g><g clip-path="url(#clip8300)"><text style="fill:#000000;fill-opacity:1;font-family:Arial,Helvetica Neue,Helvetica,sans-serif;font-size:38px;text-anchor:start" transform="rotate(0, 138.508, 1474.23)" x="138.508" y="1474.23">-</text></g><g clip-path="url(#clip8300)"><text style="fill:#000000;fill-opacity:1;font-family:Arial,Helvetica Neue,Helvetica,sans-serif;font-size:38px;text-anchor:start" transform="rotate(0, 161.347, 1474.23)" x="161.347" y="1474.23">5 </text></g><g clip-path="url(#clip8300)"><text style="fill:#000000;fill-opacity:1;font-family:Arial,Helvetica Neue,Helvetica,sans-serif;font-size:48px;text-anchor:start" transform="rotate(0, 84.9832, 1106.71)" x="84.9832" y="1106.71">10</text></g><g clip-path="url(#clip8300)"><text style="fill:#000000;fill-opacity:1;font-family:Arial,Helvetica Neue,Helvetica,sans-serif;font-size:38px;text-anchor:start" transform="rotate(0, 138.508, 1079.3)" x="138.508" y="1079.3">-</text></g><g clip-path="url(#clip8300)"><text style="fill:#000000;fill-opacity:1;font-family:Arial,Helvetica Neue,Helvetica,sans-serif;font-size:38px;text-anchor:start" transform="rotate(0, 161.347, 1079.3)" x="161.347" y="1079.3">4 </text></g><g clip-path="url(#clip8300)"><text style="fill:#000000;fill-opacity:1;font-family:Arial,Helvetica Neue,Helvetica,sans-serif;font-size:48px;text-anchor:start" transform="rotate(0, 84.9832, 711.786)" x="84.9832" y="711.786">10</text></g><g clip-path="url(#clip8300)"><text style="fill:#000000;fill-opacity:1;font-family:Arial,Helvetica Neue,Helvetica,sans-serif;font-size:38px;text-anchor:start" transform="rotate(0, 138.508, 684.376)" x="138.508" y="684.376">-</text></g><g clip-path="url(#clip8300)"><text style="fill:#000000;fill-opacity:1;font-family:Arial,Helvetica Neue,Helvetica,sans-serif;font-size:38px;text-anchor:start" transform="rotate(0, 161.347, 684.376)" x="161.347" y="684.376">3 </text></g><g clip-path="url(#clip8300)"><text style="fill:#000000;fill-opacity:1;font-family:Arial,Helvetica Neue,Helvetica,sans-serif;font-size:48px;text-anchor:start" transform="rotate(0, 84.9832, 316.859)" x="84.9832" y="316.859">10</text></g><g clip-path="url(#clip8300)"><text style="fill:#000000;fill-opacity:1;font-family:Arial,Helvetica Neue,Helvetica,sans-serif;font-size:38px;text-anchor:start" transform="rotate(0, 138.508, 289.449)" x="138.508" y="289.449">-</text></g><g clip-path="url(#clip8300)"><text style="fill:#000000;fill-opacity:1;font-family:Arial,Helvetica Neue,Helvetica,sans-serif;font-size:38px;text-anchor:start" transform="rotate(0, 161.347, 289.449)" x="161.347" y="289.449">2 </text></g><polyline clip-path="url(#clip8302)" style="stroke:#009af9;stroke-width:4;stroke-opacity:1;fill:none" points=" 278.383,88.0053 298.726,430.472 319.069,654.342 339.412,785.154 359.754,888.738 380.097,977.15 400.44,1031.83 420.783,1078.34 441.126,1117.16 461.469,1148.3  481.812,1163.01 502.155,1178.13 522.498,1192.44 542.841,1205.31 563.184,1217.36 583.527,1228.23 603.87,1238.57 624.213,1248.81 644.556,1256.39 664.899,1261.68  685.242,1266.19 705.585,1270.43 725.928,1274.54 746.271,1278.54 766.614,1282.56 786.957,1286.87 807.3,1291.45 827.643,1295.52 847.986,1298.94 868.329,1302.13  888.672,1305.2 909.015,1308.24 929.358,1311.37 949.701,1314.74 970.044,1318.44 990.387,1322.4 1010.73,1326.49 1031.07,1330.56 1051.42,1334.42 1071.76,1338  1092.1,1341.34 1112.44,1344.49 1132.79,1347.44 1153.13,1350.24 1173.47,1354.13 1193.82,1359.48 1214.16,1362.39 1234.5,1365.16 1254.85,1367.92 1275.19,1370.62  1295.53,1373.28 1315.87,1375.89 1336.22,1378.48 1356.56,1381.06 1376.9,1383.67 1397.25,1386.39 1417.59,1389.32 1437.93,1392.52 1458.28,1395.92 1478.62,1399.24  1498.96,1402.1 1519.3,1404.31 1539.65,1406.01 1559.99,1407.5 1580.33,1408.98 1600.68,1410.5 1621.02,1412.03 1641.36,1413.55 1661.7,1415.02 1682.05,1416.43  1702.39,1417.79 1722.73,1419.1 1743.08,1420.37 1763.42,1421.59 1783.76,1422.79 1804.11,1423.97 1824.45,1425.13 1844.79,1426.28 1865.13,1427.43 1885.48,1428.57  1905.82,1429.7 1926.16,1430.83 1946.51,1431.95 1966.85,1433.06 1987.19,1434.15 2007.54,1435.22 2027.88,1436.26 2048.22,1437.27 2068.56,1438.24 2088.91,1439.18  2109.25,1440.07 2129.59,1440.93 2149.94,1441.75 2170.28,1442.54 2190.62,1443.29 2210.97,1444.02 2231.31,1444.72 2251.65,1445.4 2271.99,1446.07 2292.34,1446.71  "></polyline><path clip-path="url(#clip8300)" d="
M1888.27 251.724 L2280.76 251.724 L2280.76 130.764 L1888.27 130.764  Z " fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path><polyline clip-path="url(#clip8300)" style="stroke:#000000;stroke-width:4;stroke-opacity:1;fill:none" points=" 1888.27,251.724 2280.76,251.724 2280.76,130.764 1888.27,130.764 1888.27,251.724  "></polyline><polyline clip-path="url(#clip8300)" style="stroke:#009af9;stroke-width:4;stroke-opacity:1;fill:none" points=" 1912.27,191.244 2056.27,191.244  "></polyline><g clip-path="url(#clip8300)"><text style="fill:#000000;fill-opacity:1;font-family:Arial,Helvetica Neue,Helvetica,sans-serif;font-size:48px;text-anchor:start" transform="rotate(0, 2080.27, 208.744)" x="2080.27" y="208.744">Losses</text></g></svg></div></div></div><div class="nb-cell nb-markdown-cell"><h2>おわりに</h2><p>協調フィルタリングで広く使われる MF の実装の一つである ALS の数学的な背景とその実装を確認しました。実際に MF する際は Apache Spark に実装された ALS を用いることが多いと思いますが、こうして中身が分かると少しだけ安心感も増す感じがします。</p><p>ALS は MF のためのものではありますが、交互に二乗誤差を修正する、という考え方自体は他にも適用できるものです。実際、 Factorization Marchines（FM）の論文では FM が ALS で解けると書かれています。</p><p>実はこのブログは当初 FM の勉強のために書こうとしたものなのです。しかしいかんせん、長くなってきたのでここで一旦終わります。機会があれば FM を ALS （または MCMC）で解いてみたいと思います。</p></div><div class="nb-cell nb-markdown-cell"><h2>参考</h2><ul><li><a href="http://yamaguchiyuto.hatenablog.com/entry/2016/11/12/100000">Alternating Least Square (ALS) でCP分解 - でかいチーズをベーグルする</a></li><li><a href="https://github.com/mickeykedia/Matrix-Factorization-ALS/blob/master/ALS%20Python%20Implementation.py">Matrix-Factorization-ALS/ALS Python Implementation.py at master · mickeykedia/Matrix-Factorization-ALS</a></li><li><a href="https://towardsdatascience.com/prototyping-a-recommender-system-step-by-step-part-2-alternating-least-square-als-matrix-4a76c58714a1">Prototyping a Recommender System Step by Step Part 2: Alternating Least Square (ALS) Matrix Factorization in Collaborative Filtering</a></li><li><a href="https://datasciencemadesimpler.wordpress.com/tag/alternating-least-squares/">Alternating Least Squares – Data Science Made Simpler</a></li><li><a href="https://endymecy.gitbooks.io/spark-ml-source-analysis/content/%E6%8E%A8%E8%8D%90/papers/Large-scale%20Parallel%20Collaborative%20Filtering%20the%20Netflix%20Prize.pdf">Large-scale Parallel Collaborative Filtering for the Netflix Prize</a></li></ul><p>なおこの記事は <a href="https://hub.docker.com/layers/jupyter/datascience-notebook/7a0c7325e470/images/sha256-18ef2702c6a25bd26b81e7b6dc831adb2bc294ae7bc9b011150b8f4573c41d4a">jupyter/datascience-notebook:7a0c7325e470</a> で起動した Jupyter Notebook を使って書かれています：</p><pre class="language-bash"><code class="language-bash">docker run --rm -it -p <span class="token number">8888</span>:8888 -v <span class="token environment constant">$PWD</span>/pages:/app/notebooks -w /app/notebooks jupyter/datascience-notebook:7a0c7325e470<!-- -->
</code></pre></div></div></div></section></article></main><div class="col-xl-4"><div class="pl-xl-2"><aside class="widget mb-4"><h1 class="title font-weight-bold">About Me</h1><div><img src="/static/images/haniwa.jpg" alt="avatar" class="avatar rounded-circle mb-4 mx-auto d-block"/><p>Software Engineer at FLYWHEEL. Working mainly on recommendation systems in these days. Ex-Qiita CTO.<a href="/about" style="margin-left:4px">Read more</a>.</p></div></aside><aside class="widget mb-4"><h1 class="title font-weight-bold">Follow</h1><ul class="list-inline icons"><li class="list-inline-item"><a href="https://twitter.com/yuku_t"><span class="fa-stack fa-lg"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="circle" class="svg-inline--fa fa-circle fa-w-16 fa-stack-2x" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8z"></path></svg><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="twitter" class="svg-inline--fa fa-twitter fa-w-16 fa-inverse fa-stack-1x" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"></path></svg></span></a></li><li class="list-inline-item"><a href="https://github.com/yuku"><span class="fa-stack fa-lg"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="circle" class="svg-inline--fa fa-circle fa-w-16 fa-stack-2x" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8z"></path></svg><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="github" class="svg-inline--fa fa-github fa-w-16 fa-inverse fa-stack-1x" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg></span></a></li><li class="list-inline-item"><a href="/static/rss-feed.xml"><span class="fa-stack fa-lg"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="circle" class="svg-inline--fa fa-circle fa-w-16 fa-stack-2x" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8z"></path></svg><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="rss" class="svg-inline--fa fa-rss fa-w-14 fa-inverse fa-stack-1x" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M128.081 415.959c0 35.369-28.672 64.041-64.041 64.041S0 451.328 0 415.959s28.672-64.041 64.041-64.041 64.04 28.673 64.04 64.041zm175.66 47.25c-8.354-154.6-132.185-278.587-286.95-286.95C7.656 175.765 0 183.105 0 192.253v48.069c0 8.415 6.49 15.472 14.887 16.018 111.832 7.284 201.473 96.702 208.772 208.772.547 8.397 7.604 14.887 16.018 14.887h48.069c9.149.001 16.489-7.655 15.995-16.79zm144.249.288C439.596 229.677 251.465 40.445 16.503 32.01 7.473 31.686 0 38.981 0 48.016v48.068c0 8.625 6.835 15.645 15.453 15.999 191.179 7.839 344.627 161.316 352.465 352.465.353 8.618 7.373 15.453 15.999 15.453h48.068c9.034-.001 16.329-7.474 16.005-16.504z"></path></svg></span></a></li></ul></aside></div></div></div></div><footer class="text-center mt-4"><p class="mb-0 text-dark"><small>© Yuku Takahashi <!-- -->2021<!-- --> - This work is licensed under a<!-- --> <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0 </a></small></p></footer></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"meta":{"description":"協調フィルタリングで広く使われる MF の実装の一つである ALS アルゴリズムの数学的な背景を確認し、 Julia を使って実装する。","format":"ipynb","publishedAt":"2020-01-06T10:09:00+09:00","modifiedAt":"2020-01-06T10:33:00+09:00","tags":["julia"],"title":"Matrix Factorization のための ALS アルゴリズムの数理と実装"}}},"page":"/blog/2020/01/als-for-matrix-factorization","query":{},"buildId":"YrRQiV7tW98lnKO8CCW6h","nextExport":true,"isFallback":false,"gip":true,"appGip":true}</script><script nomodule="" src="/_next/static/chunks/polyfills-3fa9f7fa683372911569.js"></script><script src="/_next/static/chunks/main-75bd50777575514fc5f3.js" async=""></script><script src="/_next/static/chunks/webpack-50bee04d1dc61f8adf5b.js" async=""></script><script src="/_next/static/chunks/framework.ae55bf7e6c20d673e3c3.js" async=""></script><script src="/_next/static/chunks/a9a7754c.c8764ee11937355f24a2.js" async=""></script><script src="/_next/static/chunks/cb1608f2.e00f163fcc55cfdbda67.js" async=""></script><script src="/_next/static/chunks/f49d73988a24b1a368deb881432b3c745a8ffbf3.97290e5451f6acb178cd.js" async=""></script><script src="/_next/static/chunks/b7332b03a5404fa9d49d0c74802b2933c91d9989.68e21dee9072a78dd756.js" async=""></script><script src="/_next/static/chunks/pages/_app-c8c98de076f140808cb7.js" async=""></script><script src="/_next/static/chunks/75fc9c18.60c1ab7504f6eb9ff2f2.js" async=""></script><script src="/_next/static/chunks/617355b6010ccfcb4c6aa531bf90c08da739fc7f.98df9cb45d4979d93192.js" async=""></script><script src="/_next/static/chunks/pages/blog/2020/01/als-for-matrix-factorization-92dcdccccfaa92f55f4e.js" async=""></script><script src="/_next/static/YrRQiV7tW98lnKO8CCW6h/_buildManifest.js" async=""></script><script src="/_next/static/YrRQiV7tW98lnKO8CCW6h/_ssgManifest.js" async=""></script></body></html>